# Copyright (c) 2007 Alexander Færøy <ahf@exherbo.org>
# Copyright (c) 2008 Ingmar Vanhassel <ingmar@exherbo.org>
# Distributed under the terms of the GNU General Public License v2

require bash-completion distutils

SUMMARY="A fast, lightweight, distributed source control management system"
HOMEPAGE="http://www.selenic.com/${PN}/wiki/"
DOWNLOADS="http://www.selenic.com/${PN}/release/${PNV}.tar.gz"

UPSTREAM_DOCUMENTATION="
http://www.selenic.com/mercurial/wiki/index.cgi/UpgradeNotes [[
    lang = en
    description = [ Important notes on upgrading from various versions ]
]]"
UPSTREAM_RELEASE_NOTES="http://www.selenic.com/mercurial/wiki/index.cgi/WhatsNew [[ lang = en ]]"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS=""

DEPENDENCIES="
    build+run:
      >=dev-lang/python-2.3:="

PYTHON_MODNAME="${PN} hgext"

src_test() {
    cd tests || die "Couldn't enter tests"

    # Tests fail due to changed error messages
    # tar
    rm -f test-archive || die "Bad tests (1)"
    # glibc
    rm -f test-bad-pull test-http-proxy test-static-http || die "Bad tests (2)"
    # no clue
    rm -f test-inotify-issue1371 || die "Bad tests (3)"

    ${python} ./run-tests.py --tmpdir="${TEMP}" || die "${python} .run-tests.py --tmpdir=\"${TEMP}\" failed"
}

