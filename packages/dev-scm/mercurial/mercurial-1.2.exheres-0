# Copyright (c) 2007 Alexander Færøy <ahf@exherbo.org>
# Copyright (c) 2008, 2009 Ingmar Vanhassel <ingmar@exherbo.org>
# Distributed under the terms of the GNU General Public License v2

require bash-completion distutils

SUMMARY="A fast, lightweight, distributed source control management system"
HOMEPAGE="http://www.selenic.com/${PN}/wiki/"
DOWNLOADS="http://www.selenic.com/${PN}/release/${PNV}.tar.gz"

UPSTREAM_RELEASE_NOTES="
    http://www.selenic.com/mercurial/wiki/index.cgi/WhatsNew [[ lang = en ]]
    http://www.selenic.com/mercurial/wiki/index.cgi/UpgradeNotes [[
        lang = en
        description = [ Important notes on upgrading from previous versions ]
    ]]
"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS=""

DEPENDENCIES="
    build+run:
      dev-lang/python:=[>=2.3]"

PYTHON_MODNAME="${PN} hgext"

src_test() {
    cd tests || die "Couldn't enter tests"

    # Tests fail due to changed error message (from tar)
    rm -f test-archive || die "Bad tests (1)"

    ${python} ./run-tests.py \
        --tmpdir="${TEMP}" \
        --verbose || die "${python} .run-tests.py --tmpdir=\"${TEMP}\" failed"
}

src_install() {
    distutils_src_install
    dobashcompletion contrib/bash_completion
    doman doc/hg*.?
    dodoc doc/{hg.1,hgignore.5,hgrc.5}.{html,txt} contrib/sample.hgrc
}

