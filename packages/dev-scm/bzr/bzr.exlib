# Copyright 2009 Wulf C. Krueger <philantrop@exherbo.org>
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'bzr-1.10.ebuild' from Gentoo, which is:
#     Copyright 1999-2008 Gentoo Foundation
require launchpad
require python [ python_dep=2.5 ] bash-completion
require distutils [ python_modules=[ bzrlib ] ]

export_exlib_phases src_test_expensive src_install

MY_PV=${PV/_}

SUMMARY="Bazaar is a simple distributed version control system."
DESCRIPTION="
Bazaar is a simple decentralized revision control system. Decentralized revision
control systems give users the ability to branch remote repositories to a local
context. Users can commit to local branches without requiring special permission
from the branches that they branched from.
If you have a choice, use dev-scm/git instead.
"
HOMEPAGE="http://bazaar-vcs.org"

BUGS_TO="philantrop@exherbo.org"
REMOTE_IDS="freshmeat:${PN} launchpad:${PN}"

UPSTREAM_RELEASE_NOTES="http://doc.bazaar-vcs.org/${PN}.dev/en/release-notes/NEWS.html"
UPSTREAM_DOCUMENTATION="${HOMEPAGE}/Documentation [[ lang = en ]]"

LICENCES="GPL-2"
SLOT="0"
MYOPTIONS=""
RESTRICT="test"

DEPENDENCIES="
    recommendation:
        dev-scm/git [[ description = [ A much better SCM ] ]]
    suggestion:
        dev-python/paramiko [[ description = [ Provides sftp support ] ]]
        dev-scm/bzrtools [[ description = [ Provides rsync support, and other useful extra functionality ] ]]
"

WORK="${WORKBASE}"/${PN}-${MY_PV}

bzr_src_test_expensive() {
    # Some tests expect the usual pyc compiling behaviour.
    python_enable_pyc
    "${python}" bzr --no-plugins selftest || die "bzr selftest failed"
    # Just to make sure we don't hit any errors on later stages.
    python_disable_pyc
}

bzr_src_install() {
    distutils_src_install

    insinto /usr/share/doc/${PNVR}
    doins -r doc/en/*
    mv "${IMAGE}"/usr{,/share}/man || die "Failed to move man-pages"

    dobashcompletion contrib/bash/bzr
}

