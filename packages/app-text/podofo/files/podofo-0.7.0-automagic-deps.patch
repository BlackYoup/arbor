From 11f7bed53c4d354d746f834067d3cd55edd8259a Mon Sep 17 00:00:00 2001
From: Wulf C. Krueger <philantrop@exherbo.org>
Date: Sat, 16 May 2009 22:07:04 +0200
Subject: [PATCH] Make fontconfig and lua properly optional.
 Reason: cf. subject
 Upstream: Yes.

---
 CMakeLists.txt |   38 +++++++++++++++-----------------------
 1 files changed, 15 insertions(+), 23 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index a1adb18..af327d8 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -98,15 +98,6 @@ ELSE(WIN32)
     SET(EXTRA_INCLUDES)
 ENDIF(WIN32)
 
-IF(UNIX)
-    SET(WANT_FONTCONFIG TRUE CACHE INTERNAL
-        "True if PoDoFo should be built with fontconfig support")
-ELSE(UNIX)
-    SET(WANT_FONTCONFIG FALSE CACHE INTERNAL
-        "True if PoDoFo should be built with fontconfig support")
-ENDIF(UNIX)
-
-
 IF(CMAKE_COMPILER_IS_GNUCXX)
     MESSAGE("Using gcc specific compiler options")
     # We can be more specific about what we want out of g++
@@ -241,9 +232,6 @@ IF(WANT_FONTCONFIG)
 	  MESSAGE("Could not find fontconfig.")
         ENDIF(FONTCONFIG_FOUND)
 ELSE(WANT_FONTCONFIG)
-	# Might as well look for it anyway. This also sets the appropriate
-	# variables to empty values.
-	FIND_PACKAGE(FONTCONFIG)
 	SET(PODOFO_LIB_FONTCONFIG:STRING)
 ENDIF(WANT_FONTCONFIG)
 
@@ -269,17 +257,21 @@ ELSE(DEFINED JPEG_RUNTIME_COMPATIBLE)
 	ENDIF(NOT WIN32)
 ENDIF(DEFINED JPEG_RUNTIME_COMPATIBLE)
 
-FIND_PACKAGE(LUA)
-IF(LUA_FOUND)
-	# If we have lua, we can build podofoimpose.
-	MESSAGE("Lua found - PoDoFoImpose will be built with Lua support")
-	MESSAGE(" * Lua include directory: ${LUA_INCLUDE_DIR}")
-	MESSAGE(" * Lua libraries: ${LUA_LIBRARIES}")
-	INCLUDE_DIRECTORIES(${LUA_INCLUDE_DIR})
-	ADD_DEFINITIONS(-DPODOFO_HAVE_LUA)
-ELSE(LUA_FOUND)
-	MESSAGE("Lua not found - PoDoFoImpose will be built without Lua support")
-ENDIF(LUA_FOUND)
+
+OPTION(WITH_LUA "Enable Lua support for PoDoFoImpose" ON)
+if(WITH_LUA)
+	FIND_PACKAGE(LUA REQUIRED)
+	IF(LUA_FOUND)
+		# If we have lua, we can build podofoimpose.
+		MESSAGE("Lua found - PoDoFoImpose will be built with Lua support")
+		MESSAGE(" * Lua include directory: ${LUA_INCLUDE_DIR}")
+		MESSAGE(" * Lua libraries: ${LUA_LIBRARIES}")
+		INCLUDE_DIRECTORIES(${LUA_INCLUDE_DIR})
+		ADD_DEFINITIONS(-DPODOFO_HAVE_LUA)
+	ELSE(LUA_FOUND)
+		MESSAGE("Lua not found - PoDoFoImpose will be built without Lua support")
+	ENDIF(LUA_FOUND)
+ENDIF(WITH_LUA)
 
 
 # Check if we should build a multithreaded version of PODOFO
-- 
1.6.3

