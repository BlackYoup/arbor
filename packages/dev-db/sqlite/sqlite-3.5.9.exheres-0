# Copyright 2008 Ingmar Vanhassel <ingmar@exherbo.org>
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'sqlite-3.5.6.ebuild' from Gentoo, which is:
#     Copyright 1999-2008 Gentoo Foundation.

require versionator flag-o-matic

SUMMARY="An embedded SQL database engine"
HOMEPAGE="http://www.sqlite.org/"
DOWNLOADS="http://www.sqlite.org/${PNV}.tar.gz
    doc? ( http://www.sqlite.org/${PN}_docs_$(replace_all_version_separators _).zip )"

LICENCES="as-is"
SLOT="3"
PLATFORMS="~amd64 ~ppc64 ~x86"
MYOPTIONS="debug doc soundex tcl"

DEPENDENCIES="
    build:
        doc? ( app-arch/unzip )
    build+run:
        tcl? ( dev-lang/tcl:= ) [[ description = [ The testsuite uses tcl ] ]]"

RESTRICT="!tcl? ( test )"

DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( debug tcl )
DEFAULT_SRC_CONFIGURE_PARAMS=( --enable-threadsafe --enable-cross-thread-connections )
DEFAULT_SRC_INSTALL_PARAMS=( TCLLIBDIR="/usr/$(get_libdir)" )

src_configure() {
    option soundex && append-flags -DSQLITE_SOUNDEX=1
    default
}

src_install() {
    default

    newbin lemon lemon-${SLOT}
    doman sqlite3.1

    if option doc; then
        insinto /usr/share/doc/${PNVR}/html
        # 3.6.2: option doc && doins -r "${WORKBASE}"/${PN}_docs_$(replace_all_version_separators _)/
        doins -r "${WORKBASE}"/${PN}-docs-${PV}/
    fi
}

