# Copyright 2008, 2009, 2011 Ingmar Vanhassel <ingmar@exherbo.org>
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'sqlite-3.5.6.ebuild' from Gentoo, which is:
#     Copyright 1999-2008 Gentoo Foundation.

SCHNARF_PV="$(ever range 1)$(printf "%02d" $(ever range 2))$(printf "%02d" $(ever range 3))00"

require flag-o-matic

SUMMARY="An embedded SQL database engine"
HOMEPAGE="http://www.sqlite.org/"
DOWNLOADS="http://www.sqlite.org/${PN}-autoconf-${SCHNARF_PV}.tar.gz
    doc? ( http://www.sqlite.org/${PN}-doc-${SCHNARF_PV}.zip )"

REMOTE_IDS="freshmeat:${PN}"

LICENCES="public-domain"
SLOT="3"
PLATFORMS="~amd64 ~arm ~ppc64 ~x86"
MYOPTIONS="doc readline
    unlock-notify [[ description = [ Enables an API for notifications when a database is unlocked in shared-cache mode, cf. http://www.sqlite.org/c3ref/unlock_notify.html ] ]]
"

DEPENDENCIES="
    build:
        doc? ( app-arch/unzip )
    build+run:
        readline? ( sys-libs/readline )
"

DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( readline )
DEFAULT_SRC_CONFIGURE_PARAMS=( --enable-threadsafe --enable-dynamic-extensions )

WORK=${WORKBASE}/${PN}-autoconf-${SCHNARF_PV}/

src_configure() {
    option unlock-notify && append-cppflags -DSQLITE_ENABLE_UNLOCK_NOTIFY

    default
}

src_install() {
    default

    if option doc ; then
        insinto /usr/share/doc/${PNVR}/html
        doins -r "${WORKBASE}"/${PN}-doc-${SCHNARF_PV}/*
    fi
}

