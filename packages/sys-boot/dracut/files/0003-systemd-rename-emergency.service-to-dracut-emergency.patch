From ebbd7ed7066d16135826067fb7d5ac4cfd55406e Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Thu, 4 Oct 2012 13:24:07 -0400
Subject: [PATCH 3/4] systemd: rename emergency.service to
 dracut-emergency.service for rd.shell

---
 modules.d/98systemd/module-setup.sh | 4 +++-
 modules.d/99base/dracut-lib.sh      | 2 +-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/modules.d/98systemd/module-setup.sh b/modules.d/98systemd/module-setup.sh
index 577bcb9..5576792 100755
--- a/modules.d/98systemd/module-setup.sh
+++ b/modules.d/98systemd/module-setup.sh
@@ -29,6 +29,7 @@ install() {
         $systemdutildir/systemd-fsck \
         $systemdutildir/systemd-udevd \
         $systemdutildir/systemd-journald \
+        $systemdutildir/systemd-sysctl \
         $systemdsystemunitdir/emergency.target \
         $systemdsystemunitdir/sysinit.target \
         $systemdsystemunitdir/basic.target \
@@ -56,6 +57,7 @@ install() {
         $systemdsystemunitdir/systemd-ask-password-plymouth.path \
         $systemdsystemunitdir/systemd-journald.socket \
         $systemdsystemunitdir/systemd-ask-password-console.service \
+        $systemdsystemunitdir/emergency.service \
         $systemdsystemunitdir/halt.service \
         $systemdsystemunitdir/poweroff.service \
         $systemdsystemunitdir/systemd-reboot.service \
@@ -105,7 +107,7 @@ install() {
 
     ln -fs $systemdutildir/systemd "$initdir/init"
 
-    inst_simple "$moddir/emergency.service" ${systemdsystemunitdir}/emergency.service
+    inst_simple "$moddir/dracut-emergency.service" ${systemdsystemunitdir}/dracut-emergency.service
     inst_simple "$moddir/rescue.service" ${systemdsystemunitdir}/rescue.service
     ln -fs "basic.target" "${initdir}${systemdsystemunitdir}/default.target"
 
diff --git a/modules.d/99base/dracut-lib.sh b/modules.d/99base/dracut-lib.sh
index c044ec8..f0acdf1 100755
--- a/modules.d/99base/dracut-lib.sh
+++ b/modules.d/99base/dracut-lib.sh
@@ -870,7 +870,7 @@ _emergency_shell()
     if [ -n "$DRACUT_SYSTEMD" ]; then
         > /.console_lock
         echo "PS1=\"$_name:\${PWD}# \"" >/etc/profile
-        systemctl start emergency.service
+        systemctl start dracut-emergency.service
         rm -f /.console_lock
     else
         echo "Dropping to debug shell."
-- 
1.7.12.2

