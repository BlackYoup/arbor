# Copyright 2008 Bo Ã˜rsted Andresen
# Distributed under the terms of the GNU General Public License v2
#
# Inspired from Gentoo's ccache-2.4-r7.ebuild which is:
#   Copyright 1999-2008 Gentoo Foundation

require multilib

MY_PNV=${PNV/_pre/pre}

SUMMARY="Compiler cache"
HOMEPAGE="http://ccache.samba.org/"
DOWNLOADS="http://samba.org/ftp/${PN}/${MY_PNV}.tar.xz"

UPSTREAM_RELEASE_NOTES="http://samba.org/ftp/${PN}/${MY_PNV}-NEWS"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS=""

DEPENDENCIES="
    build:
        app-arch/xz
    build+run:
        sys-libs/zlib[>=1.2.3]
"

WORK=${WORKBASE}/${MY_PNV}

src_prepare() {
    # The check is broken and configure.ac is not shipped
    # this has already been fixed upstream
    edo sed -e '/^if test -z "$ac_ct_AR"; then/s:ac_ct_AR:AR:' -i configure
}

src_install() {
    default

    dodir /usr/libexec/ccache/
    insinto /usr/libexec/ccache/
    local f
    for f in {${CHOST}-,}{gcc,g++,c++}; do
        dosym /usr/bin/ccache /usr/libexec/ccache/${f}
    done
}

