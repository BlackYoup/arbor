Upstream: no, upstream doesn't care about non-glibc...
Source: Adapted for 0.165 from https://github.com/voidlinux/void-packages/commit/cb86b9c0fdd3339f2b68c6a1439a3be9ce93c534

diff -ru elfutils-0.165.orig/Makefile.in elfutils-0.165/Makefile.in
--- elfutils-0.165.orig/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/Makefile.in	2016-01-18 01:00:23.415537048 -0500
@@ -341,6 +341,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -356,6 +357,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/backends/Makefile.in elfutils-0.165/backends/Makefile.in
--- elfutils-0.165.orig/backends/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/backends/Makefile.in	2016-01-18 01:00:23.600535375 -0500
@@ -364,6 +364,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -379,6 +380,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/config/Makefile.in elfutils-0.165/config/Makefile.in
--- elfutils-0.165.orig/config/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/config/Makefile.in	2016-01-18 01:00:23.675534697 -0500
@@ -255,6 +255,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -270,6 +271,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/configure.ac elfutils-0.165/configure.ac
--- elfutils-0.165.orig/configure.ac	2016-01-08 07:50:21.000000000 -0500
+++ elfutils-0.165/configure.ac	2016-01-18 00:59:11.650185987 -0500
@@ -316,6 +316,62 @@
 fi
 AC_SUBST([argp_LDADD])
 
+dnl Check if we have fts available from our libc
+AC_LINK_IFELSE(
+	[AC_LANG_PROGRAM(
+		[#if !defined(__x86_64__)
+		#undef  _FILE_OFFSET_BITS
+		#define _FILE_OFFSET_BITS 32
+		#endif
+		#include <fts.h>],
+		[FTS* fts = 0; return fts_close(fts); return 0;]
+		)],
+	[libc_has_fts="true"],
+	[libc_has_fts="false"]
+)
+
+dnl If our libc doesn't provide fts, then test for libfts
+if test "$libc_has_fts" = "false" ; then
+	AC_MSG_WARN("libc does not have fts")
+	AC_CHECK_LIB([fts], [fts_close], [have_fts="true"], [have_fts="false"])
+
+	if test "$have_fts" = "false"; then
+		AC_MSG_ERROR("no libfts found")
+	else
+		fts_LDADD="-lfts"
+	fi
+else
+	fts_LDADD=""
+fi
+AC_SUBST([fts_LDADD])
+
+dnl Check if we have obstack available from our libc
+AC_LINK_IFELSE(
+	[AC_LANG_PROGRAM(
+		[#include <obstack.h>],
+		[_obstack_begin(0, 0, 0, NULL, NULL); return 0;]
+		)],
+	[libc_has_obstack="true"],
+	[libc_has_obstack="false"]
+)
+
+dnl If our libc doesn't provide obstack, then test for libobstack
+if test "$libc_has_obstack" = "false" ; then
+	AC_MSG_WARN("libc does not have obstack")
+	AC_CHECK_LIB([obstack], [_obstack_begin], [have_obstack="true"], [have_obstack="false"])
+
+	if test "$have_obstack" = "false"; then
+		AC_MSG_ERROR("no libobstack found")
+	else
+		obstack_LDADD="-lobstack"
+	fi
+else
+	obstack_LDADD=""
+fi
+AC_SUBST([obstack_LDADD])
+
+dnl The directories with content.
+
 dnl The directories with content.
 
 dnl Documentation.
diff -ru elfutils-0.165.orig/lib/Makefile.am elfutils-0.165/lib/Makefile.am
--- elfutils-0.165.orig/lib/Makefile.am	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/lib/Makefile.am	2016-01-18 15:30:29.777139418 -0500
@@ -29,7 +29,7 @@
 ##
 include $(top_srcdir)/config/eu.am
 AM_CFLAGS += -fPIC
-AM_CPPFLAGS += -I$(srcdir)/../libelf
+AM_CPPFLAGS += -I$(srcdir)/../libelf -I$(srcdir)/lib
 
 noinst_LIBRARIES = libeu.a
 
diff -ru elfutils-0.165.orig/lib/Makefile.in elfutils-0.165/lib/Makefile.in
--- elfutils-0.165.orig/lib/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/lib/Makefile.in	2016-01-18 01:00:23.781533739 -0500
@@ -275,6 +275,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -290,6 +291,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/lib/color.c elfutils-0.165/lib/color.c
--- elfutils-0.165.orig/lib/color.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/lib/color.c	2016-01-18 15:28:33.870187481 -0500
@@ -32,7 +32,7 @@
 #endif
 
 #include <argp.h>
-#include <error.h>
+#include "system.h"
 #include <libintl.h>
 #include <stdlib.h>
 #include <string.h>
diff -ru elfutils-0.165.orig/lib/fixedsizehash.h elfutils-0.165/lib/fixedsizehash.h
--- elfutils-0.165.orig/lib/fixedsizehash.h	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/lib/fixedsizehash.h	2016-01-18 00:59:11.650185987 -0500
@@ -30,12 +30,12 @@
 #include <errno.h>
 #include <stdlib.h>
 #include <string.h>
-#include <sys/cdefs.h>
 #include <sys/param.h>
 
 #include <system.h>
 
-#define CONCAT(t1,t2) __CONCAT (t1,t2)
+#define CONCAT1(x,y) x##y
+#define CONCAT(x,y) CONCAT1(x,y)
 
 /* Before including this file the following macros must be defined:
 
diff -ru elfutils-0.165.orig/lib/system.h elfutils-0.165/lib/system.h
--- elfutils-0.165.orig/lib/system.h	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/lib/system.h	2016-01-18 15:28:33.896187246 -0500
@@ -35,6 +35,7 @@
 #include <endian.h>
 #include <byteswap.h>
 #include <unistd.h>
+#include <fcntl.h>
 
 #if __BYTE_ORDER == __LITTLE_ENDIAN
 # define LE32(n)	(n)
@@ -50,6 +51,45 @@
 # error "Unknown byte order"
 #endif
 
+#if !defined(__GLIBC__)
+
+/* Evaluate EXPRESSION, and repeat as long as it returns -1 with `errno'
+   set to EINTR.  */
+
+# define TEMP_FAILURE_RETRY(expression) \
+  (__extension__                                                              \
+    ({ long int __result;                                                     \
+       do __result = (long int) (expression);                                 \
+       while (__result == -1L && errno == EINTR);                             \
+       __result; }))
+
+#include <stdarg.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <errno.h>
+
+static unsigned int error_message_count = 0;
+
+static inline void error(int status, int errnum, const char* format, ...)
+{
+	va_list ap;
+	fprintf(stderr, "%s: ", program_invocation_name);
+	va_start(ap, format);
+	vfprintf(stderr, format, ap);
+	va_end(ap);
+	if (errnum)
+		fprintf(stderr, ": %s", strerror(errnum));
+	fprintf(stderr, "\n");
+	error_message_count++;
+	if (status)
+		exit(status);
+}
+
+#else
+#include "system.h"
+#endif
+
 extern void *xmalloc (size_t) __attribute__ ((__malloc__));
 extern void *xcalloc (size_t, size_t) __attribute__ ((__malloc__));
 extern void *xrealloc (void *, size_t) __attribute__ ((__malloc__));
diff -ru elfutils-0.165.orig/lib/xmalloc.c elfutils-0.165/lib/xmalloc.c
--- elfutils-0.165.orig/lib/xmalloc.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/lib/xmalloc.c	2016-01-18 15:28:33.870187481 -0500
@@ -30,7 +30,7 @@
 # include <config.h>
 #endif
 
-#include <error.h>
+#include "system.h"
 #include <libintl.h>
 #include <stddef.h>
 #include <stdlib.h>
diff -ru elfutils-0.165.orig/libasm/Makefile.in elfutils-0.165/libasm/Makefile.in
--- elfutils-0.165.orig/libasm/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/libasm/Makefile.in	2016-01-18 01:00:23.913532545 -0500
@@ -326,6 +326,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -341,6 +342,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/libasm/asm_end.c elfutils-0.165/libasm/asm_end.c
--- elfutils-0.165.orig/libasm/asm_end.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/libasm/asm_end.c	2016-01-18 15:28:33.924186993 -0500
@@ -32,7 +32,7 @@
 #endif
 
 #include <assert.h>
-#include <error.h>
+#include "system.h"
 #include <libintl.h>
 #include <stdio.h>
 #include <stdlib.h>
diff -ru elfutils-0.165.orig/libasm/asm_newscn.c elfutils-0.165/libasm/asm_newscn.c
--- elfutils-0.165.orig/libasm/asm_newscn.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/libasm/asm_newscn.c	2016-01-18 15:28:33.950186757 -0500
@@ -32,7 +32,7 @@
 #endif
 
 #include <assert.h>
-#include <error.h>
+#include "system.h"
 #include <libintl.h>
 #include <stdlib.h>
 #include <string.h>
diff -ru elfutils-0.165.orig/libcpu/Makefile.in elfutils-0.165/libcpu/Makefile.in
--- elfutils-0.165.orig/libcpu/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/libcpu/Makefile.in	2016-01-18 01:00:24.042531378 -0500
@@ -301,6 +301,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -316,6 +317,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/libcpu/i386_disasm.c elfutils-0.165/libcpu/i386_disasm.c
--- elfutils-0.165.orig/libcpu/i386_disasm.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/libcpu/i386_disasm.c	2016-01-18 00:59:11.651185978 -0500
@@ -710,6 +710,7 @@
 
 		case 'm':
 		  /* Mnemonic.  */
+		  str = mnebuf;
 
 		  if (unlikely (instrtab[cnt].mnemonic == MNE_INVALID))
 		    {
diff -ru elfutils-0.165.orig/libcpu/i386_gendis.c elfutils-0.165/libcpu/i386_gendis.c
--- elfutils-0.165.orig/libcpu/i386_gendis.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/libcpu/i386_gendis.c	2016-01-18 15:28:33.786188240 -0500
@@ -31,7 +31,7 @@
 # include <config.h>
 #endif
 
-#include <error.h>
+#include "system.h"
 #include <errno.h>
 #include <stdio.h>
 #include <stdlib.h>
diff -ru elfutils-0.165.orig/libcpu/i386_lex.c elfutils-0.165/libcpu/i386_lex.c
--- elfutils-0.165.orig/libcpu/i386_lex.c	2016-01-11 02:47:33.000000000 -0500
+++ elfutils-0.165/libcpu/i386_lex.c	2016-01-18 15:28:33.844187716 -0500
@@ -578,7 +578,7 @@
 #endif
 
 #include <ctype.h>
-#include <error.h>
+#include "system.h"
 #include <libintl.h>
 
 #include <system.h>
diff -ru elfutils-0.165.orig/libcpu/i386_lex.l elfutils-0.165/libcpu/i386_lex.l
--- elfutils-0.165.orig/libcpu/i386_lex.l	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/libcpu/i386_lex.l	2016-01-18 15:28:33.815187978 -0500
@@ -31,7 +31,7 @@
 #endif
 
 #include <ctype.h>
-#include <error.h>
+#include "system.h"
 #include <libintl.h>
 
 #include <system.h>
diff -ru elfutils-0.165.orig/libcpu/i386_parse.c elfutils-0.165/libcpu/i386_parse.c
--- elfutils-0.165.orig/libcpu/i386_parse.c	2016-01-11 02:47:33.000000000 -0500
+++ elfutils-0.165/libcpu/i386_parse.c	2016-01-18 15:28:33.786188240 -0500
@@ -107,7 +107,7 @@
 #include <assert.h>
 #include <ctype.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <inttypes.h>
 #include <libintl.h>
 #include <math.h>
diff -ru elfutils-0.165.orig/libcpu/i386_parse.y elfutils-0.165/libcpu/i386_parse.y
--- elfutils-0.165.orig/libcpu/i386_parse.y	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/libcpu/i386_parse.y	2016-01-18 15:28:33.815187978 -0500
@@ -34,7 +34,7 @@
 #include <assert.h>
 #include <ctype.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <inttypes.h>
 #include <libintl.h>
 #include <math.h>
diff -ru elfutils-0.165.orig/libdw/Makefile.am elfutils-0.165/libdw/Makefile.am
--- elfutils-0.165.orig/libdw/Makefile.am	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/libdw/Makefile.am	2016-01-18 00:59:11.651185978 -0500
@@ -112,7 +112,7 @@
 		-Wl,--enable-new-dtags,-rpath,$(pkglibdir) \
 		-Wl,--version-script,$<,--no-undefined \
 		-Wl,--whole-archive $(filter-out $<,$^) -Wl,--no-whole-archive\
-		-ldl -lz $(argp_LDADD) $(zip_LIBS)
+		-ldl -lz $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) $(zip_LIBS)
 	@$(textrel_check)
 	$(AM_V_at)ln -fs $@ $@.$(VERSION)
 
diff -ru elfutils-0.165.orig/libdw/Makefile.in elfutils-0.165/libdw/Makefile.in
--- elfutils-0.165.orig/libdw/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/libdw/Makefile.in	2016-01-18 01:00:24.193530013 -0500
@@ -375,6 +375,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -390,6 +391,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
@@ -996,7 +998,7 @@
 		-Wl,--enable-new-dtags,-rpath,$(pkglibdir) \
 		-Wl,--version-script,$<,--no-undefined \
 		-Wl,--whole-archive $(filter-out $<,$^) -Wl,--no-whole-archive\
-		-ldl -lz $(argp_LDADD) $(zip_LIBS)
+		-ldl -lz $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) $(zip_LIBS)
 	@$(textrel_check)
 	$(AM_V_at)ln -fs $@ $@.$(VERSION)
 
diff -ru elfutils-0.165.orig/libdw/libdw.h elfutils-0.165/libdw/libdw.h
--- elfutils-0.165.orig/libdw/libdw.h	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/libdw/libdw.h	2016-01-18 00:59:11.652185969 -0500
@@ -33,7 +33,27 @@
 #include <stdbool.h>
 #include <stddef.h>
 #include <stdint.h>
+#include <unistd.h>
+#include <alloca.h>
+#include <string.h>
 
+#ifndef TEMP_FAILURE_RETRY
+#define TEMP_FAILURE_RETRY(expression) \
+  (__extension__                                                              \
+    ({ long int __result;                                                     \
+       do __result = (long int) (expression);                                 \
+       while (__result == -1L && errno == EINTR);                             \
+       __result; }))
+#endif
+
+#ifndef strndupa
+#define strndupa(s, n) \
+       (__extension__ ({const char *__in = (s); \
+                        size_t __len = strnlen (__in, (n)) + 1; \
+                        char *__out = (char *) alloca (__len); \
+                        __out[__len-1] = '\0'; \
+                        (char *) memcpy (__out, __in, __len-1);}))
+#endif
 
 #if __GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 3)
 # define __nonnull_attribute__(...) __attribute__ ((__nonnull__ (__VA_ARGS__)))
diff -ru elfutils-0.165.orig/libdw/libdw_alloc.c elfutils-0.165/libdw/libdw_alloc.c
--- elfutils-0.165.orig/libdw/libdw_alloc.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/libdw/libdw_alloc.c	2016-01-18 15:28:33.950186757 -0500
@@ -31,7 +31,7 @@
 # include <config.h>
 #endif
 
-#include <error.h>
+#include "system.h"
 #include <errno.h>
 #include <stdlib.h>
 #include <sys/param.h>
diff -ru elfutils-0.165.orig/libdwelf/Makefile.in elfutils-0.165/libdwelf/Makefile.in
--- elfutils-0.165.orig/libdwelf/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/libdwelf/Makefile.in	2016-01-18 01:00:24.305529000 -0500
@@ -306,6 +306,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -321,6 +322,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/libdwfl/Makefile.in elfutils-0.165/libdwfl/Makefile.in
--- elfutils-0.165.orig/libdwfl/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/libdwfl/Makefile.in	2016-01-18 01:00:24.432527852 -0500
@@ -362,6 +362,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -377,6 +378,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/libdwfl/dwfl_build_id_find_elf.c elfutils-0.165/libdwfl/dwfl_build_id_find_elf.c
--- elfutils-0.165.orig/libdwfl/dwfl_build_id_find_elf.c	2016-01-02 14:50:03.000000000 -0500
+++ elfutils-0.165/libdwfl/dwfl_build_id_find_elf.c	2016-01-18 00:59:11.652185969 -0500
@@ -94,7 +94,7 @@
 	{
 	  if (*file_name != NULL)
 	    free (*file_name);
-	  *file_name = canonicalize_file_name (name);
+	  *file_name = realpath (name, NULL);
 	  if (*file_name == NULL)
 	    {
 	      *file_name = name;
diff -ru elfutils-0.165.orig/libdwfl/dwfl_error.c elfutils-0.165/libdwfl/dwfl_error.c
--- elfutils-0.165.orig/libdwfl/dwfl_error.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/libdwfl/dwfl_error.c	2016-01-18 00:59:11.652185969 -0500
@@ -154,7 +154,16 @@
   switch (error &~ 0xffff)
     {
     case OTHER_ERROR (ERRNO):
+#if defined(__GLIBC__)
       return strerror_r (error & 0xffff, "bad", 0);
+#else
+      {
+        static __thread char buf[128] = "";
+        if (0 == strerror_r(error & 0xffff, buf, sizeof(buf)))
+          return buf;
+      }
+      return "strerror_r() failed";
+#endif
     case OTHER_ERROR (LIBELF):
       return elf_errmsg (error & 0xffff);
     case OTHER_ERROR (LIBDW):
diff -ru elfutils-0.165.orig/libdwfl/find-debuginfo.c elfutils-0.165/libdwfl/find-debuginfo.c
--- elfutils-0.165.orig/libdwfl/find-debuginfo.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/libdwfl/find-debuginfo.c	2016-01-18 00:59:11.652185969 -0500
@@ -372,7 +372,7 @@
       /* If FILE_NAME is a symlink, the debug file might be associated
 	 with the symlink target name instead.  */
 
-      char *canon = canonicalize_file_name (file_name);
+      char *canon = realpath (file_name, NULL);
       if (canon != NULL && strcmp (file_name, canon))
 	fd = find_debuginfo_in_path (mod, canon,
 				     debuglink_file, debuglink_crc,
diff -ru elfutils-0.165.orig/libebl/Makefile.in elfutils-0.165/libebl/Makefile.in
--- elfutils-0.165.orig/libebl/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/libebl/Makefile.in	2016-01-18 01:00:24.556526731 -0500
@@ -327,6 +327,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -342,6 +343,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/libebl/eblopenbackend.c elfutils-0.165/libebl/eblopenbackend.c
--- elfutils-0.165.orig/libebl/eblopenbackend.c	2016-01-08 07:27:15.000000000 -0500
+++ elfutils-0.165/libebl/eblopenbackend.c	2016-01-18 15:27:45.998077421 -0500
@@ -32,12 +32,12 @@
 
 #include <assert.h>
 #include <dlfcn.h>
-#include <error.h>
 #include <libelfP.h>
 #include <dwarf.h>
 #include <stdlib.h>
 #include <string.h>
 #include <stdio.h>
+#include "system.h"
 
 #include <libeblP.h>
 
diff -ru elfutils-0.165.orig/libebl/eblwstrtab.c elfutils-0.165/libebl/eblwstrtab.c
--- elfutils-0.165.orig/libebl/eblwstrtab.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/libebl/eblwstrtab.c	2016-01-18 00:59:11.653185960 -0500
@@ -305,7 +305,7 @@
 
   /* Process the current node.  */
   nodep->offset = *offsetp;
-  *freep = wmempcpy (*freep, nodep->string, nodep->len);
+  *freep = wmemcpy (*freep, nodep->string, nodep->len) + nodep->len;
   *offsetp += nodep->len * sizeof (wchar_t);
 
   for (subs = nodep->next; subs != NULL; subs = subs->next)
diff -ru elfutils-0.165.orig/libelf/Makefile.in elfutils-0.165/libelf/Makefile.in
--- elfutils-0.165.orig/libelf/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/libelf/Makefile.in	2016-01-18 01:00:24.705525383 -0500
@@ -371,6 +371,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -386,6 +387,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/libelf/elf.h elfutils-0.165/libelf/elf.h
--- elfutils-0.165.orig/libelf/elf.h	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/libelf/elf.h	2016-01-18 00:59:11.654185951 -0500
@@ -21,6 +21,17 @@
 
 #include <features.h>
 
+#if !defined(__GLIBC__)
+/* C++ needs to know that types and declarations are C, not C++.  */
+#ifdef  __cplusplus
+# define __BEGIN_DECLS  extern "C" {
+# define __END_DECLS    }
+#else
+# define __BEGIN_DECLS
+# define __END_DECLS
+#endif
+#endif
+
 __BEGIN_DECLS
 
 /* Standard ELF types.  */
diff -ru elfutils-0.165.orig/libelf/elf_getarsym.c elfutils-0.165/libelf/elf_getarsym.c
--- elfutils-0.165.orig/libelf/elf_getarsym.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/libelf/elf_getarsym.c	2016-01-18 00:59:11.654185951 -0500
@@ -297,7 +297,7 @@
 		arsym[cnt].as_off = (*u32)[cnt];
 
 	      arsym[cnt].as_hash = _dl_elf_hash (str_data);
-	      str_data = rawmemchr (str_data, '\0') + 1;
+	      str_data = memchr (str_data, '\0', SIZE_MAX) + 1;
 	    }
 
 	  /* At the end a special entry.  */
diff -ru elfutils-0.165.orig/m4/Makefile.in elfutils-0.165/m4/Makefile.in
--- elfutils-0.165.orig/m4/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/m4/Makefile.in	2016-01-18 01:00:24.775524750 -0500
@@ -223,6 +223,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -238,6 +239,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/src/Makefile.am elfutils-0.165/src/Makefile.am
--- elfutils-0.165.orig/src/Makefile.am	2016-01-08 07:27:15.000000000 -0500
+++ elfutils-0.165/src/Makefile.am	2016-01-18 00:59:11.654185951 -0500
@@ -104,28 +104,29 @@
 ar_no_Wstack_usage = yes
 unstrip_no_Wstack_usage = yes
 
-readelf_LDADD = $(libdw) $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl
-nm_LDADD = $(libdw) $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl \
+readelf_LDADD = $(libdw) $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+nm_LDADD = $(libdw) $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl \
 	   $(demanglelib)
-size_LDADD = $(libelf) $(libeu) $(argp_LDADD)
-strip_LDADD = $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl
-ld_LDADD = $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl
+size_LDADD = $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
+strip_LDADD = $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+ld_LDADD = $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
 if NATIVE_LD
 # -ldl is always needed for libebl.
 ld_LDADD += libld_elf.a
 endif
 ld_LDFLAGS = -rdynamic
-elflint_LDADD  = $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl
-findtextrel_LDADD = $(libdw) $(libelf) $(argp_LDADD)
-addr2line_LDADD = $(libdw) $(libelf) $(argp_LDADD) $(demanglelib)
-elfcmp_LDADD = $(libebl) $(libelf) $(argp_LDADD) -ldl
-objdump_LDADD  = $(libasm) $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl
-ranlib_LDADD = libar.a $(libelf) $(libeu) $(argp_LDADD)
-strings_LDADD = $(libelf) $(libeu) $(argp_LDADD)
-ar_LDADD = libar.a $(libelf) $(libeu) $(argp_LDADD)
-unstrip_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD) -ldl
-stack_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD) -ldl $(demanglelib)
-elfcompress_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD)
+elflint_LDADD  = $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+findtextrel_LDADD = $(libdw) $(libelf) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
+addr2line_LDADD = $(libdw) $(libelf) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) $(demanglelib)
+elfcmp_LDADD = $(libebl) $(libelf) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+objdump_LDADD  = $(libasm) $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+ranlib_LDADD = libar.a $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
+strings_LDADD = $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
+ar_LDADD = libar.a $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
+unstrip_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+stack_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl \
+		$(demanglelib)
+elfcompress_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
 
 ldlex.o: ldscript.c
 ldlex_no_Werror = yes
diff -ru elfutils-0.165.orig/src/Makefile.in elfutils-0.165/src/Makefile.in
--- elfutils-0.165.orig/src/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/src/Makefile.in	2016-01-18 01:00:25.002522698 -0500
@@ -154,32 +154,39 @@
 @BUILD_STATIC_TRUE@	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_2) \
 @BUILD_STATIC_TRUE@	$(libebl)
 addr2line_DEPENDENCIES = $(am__DEPENDENCIES_3) $(am__DEPENDENCIES_2) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 ar_SOURCES = ar.c
 ar_OBJECTS = ar.$(OBJEXT)
 ar_DEPENDENCIES = libar.a $(am__DEPENDENCIES_2) $(libeu) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
 elfcmp_SOURCES = elfcmp.c
 elfcmp_OBJECTS = elfcmp.$(OBJEXT)
 elfcmp_DEPENDENCIES = $(libebl) $(am__DEPENDENCIES_2) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
 elfcompress_SOURCES = elfcompress.c
 elfcompress_OBJECTS = elfcompress.$(OBJEXT)
 elfcompress_DEPENDENCIES = $(libebl) $(am__DEPENDENCIES_2) \
-	$(am__DEPENDENCIES_3) $(libeu) $(am__DEPENDENCIES_1)
+	$(am__DEPENDENCIES_3) $(libeu) $(am__DEPENDENCIES_1) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 elflint_SOURCES = elflint.c
 elflint_OBJECTS = elflint.$(OBJEXT)
 elflint_DEPENDENCIES = $(libebl) $(am__DEPENDENCIES_2) $(libeu) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
 findtextrel_SOURCES = findtextrel.c
 findtextrel_OBJECTS = findtextrel.$(OBJEXT)
 findtextrel_DEPENDENCIES = $(am__DEPENDENCIES_3) $(am__DEPENDENCIES_2) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
 am_ld_OBJECTS = ld.$(OBJEXT) ldgeneric.$(OBJEXT) ldlex.$(OBJEXT) \
 	ldscript.$(OBJEXT) symbolhash.$(OBJEXT) sectionhash.$(OBJEXT) \
 	versionhash.$(OBJEXT)
 ld_OBJECTS = $(am_ld_OBJECTS)
 ld_DEPENDENCIES = $(libebl) $(am__DEPENDENCIES_2) $(libeu) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1) $(am__append_3)
 ld_LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(ld_LDFLAGS) $(LDFLAGS) -o \
 	$@
@@ -190,40 +197,49 @@
 nm_OBJECTS = nm.$(OBJEXT)
 nm_DEPENDENCIES = $(am__DEPENDENCIES_3) $(libebl) \
 	$(am__DEPENDENCIES_2) $(libeu) $(am__DEPENDENCIES_1) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
 objdump_SOURCES = objdump.c
 objdump_OBJECTS = objdump.$(OBJEXT)
 objdump_DEPENDENCIES = $(libasm) $(libebl) $(am__DEPENDENCIES_2) \
-	$(libeu) $(am__DEPENDENCIES_1)
+	$(libeu) $(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
+	$(am__DEPENDENCIES_1)
 ranlib_SOURCES = ranlib.c
 ranlib_OBJECTS = ranlib.$(OBJEXT)
 ranlib_DEPENDENCIES = libar.a $(am__DEPENDENCIES_2) $(libeu) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
 readelf_SOURCES = readelf.c
 readelf_OBJECTS = readelf.$(OBJEXT)
 readelf_DEPENDENCIES = $(am__DEPENDENCIES_3) $(libebl) \
-	$(am__DEPENDENCIES_2) $(libeu) $(am__DEPENDENCIES_1)
+	$(am__DEPENDENCIES_2) $(libeu) $(am__DEPENDENCIES_1) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 size_SOURCES = size.c
 size_OBJECTS = size.$(OBJEXT)
 size_DEPENDENCIES = $(am__DEPENDENCIES_2) $(libeu) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
 stack_SOURCES = stack.c
 stack_OBJECTS = stack.$(OBJEXT)
 stack_DEPENDENCIES = $(libebl) $(am__DEPENDENCIES_2) \
 	$(am__DEPENDENCIES_3) $(libeu) $(am__DEPENDENCIES_1) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
 strings_SOURCES = strings.c
 strings_OBJECTS = strings.$(OBJEXT)
 strings_DEPENDENCIES = $(am__DEPENDENCIES_2) $(libeu) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
 strip_SOURCES = strip.c
 strip_OBJECTS = strip.$(OBJEXT)
 strip_DEPENDENCIES = $(libebl) $(am__DEPENDENCIES_2) $(libeu) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
 unstrip_SOURCES = unstrip.c
 unstrip_OBJECTS = unstrip.$(OBJEXT)
 unstrip_DEPENDENCIES = $(libebl) $(am__DEPENDENCIES_2) \
-	$(am__DEPENDENCIES_3) $(libeu) $(am__DEPENDENCIES_1)
+	$(am__DEPENDENCIES_3) $(libeu) $(am__DEPENDENCIES_1) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
 am__vpath_adj = case $$p in \
     $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
@@ -439,6 +455,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -454,6 +471,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
@@ -543,26 +561,28 @@
 ranlib_no_Wstack_usage = yes
 ar_no_Wstack_usage = yes
 unstrip_no_Wstack_usage = yes
-readelf_LDADD = $(libdw) $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl
-nm_LDADD = $(libdw) $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl \
+readelf_LDADD = $(libdw) $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+nm_LDADD = $(libdw) $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl \
 	   $(demanglelib)
 
-size_LDADD = $(libelf) $(libeu) $(argp_LDADD)
-strip_LDADD = $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl
-ld_LDADD = $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl \
-	$(am__append_3)
+size_LDADD = $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
+strip_LDADD = $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+ld_LDADD = $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) \
+	$(obstack_LDADD) -ldl $(am__append_3)
 ld_LDFLAGS = -rdynamic
-elflint_LDADD = $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl
-findtextrel_LDADD = $(libdw) $(libelf) $(argp_LDADD)
-addr2line_LDADD = $(libdw) $(libelf) $(argp_LDADD) $(demanglelib)
-elfcmp_LDADD = $(libebl) $(libelf) $(argp_LDADD) -ldl
-objdump_LDADD = $(libasm) $(libebl) $(libelf) $(libeu) $(argp_LDADD) -ldl
-ranlib_LDADD = libar.a $(libelf) $(libeu) $(argp_LDADD)
-strings_LDADD = $(libelf) $(libeu) $(argp_LDADD)
-ar_LDADD = libar.a $(libelf) $(libeu) $(argp_LDADD)
-unstrip_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD) -ldl
-stack_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD) -ldl $(demanglelib)
-elfcompress_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD)
+elflint_LDADD = $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+findtextrel_LDADD = $(libdw) $(libelf) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
+addr2line_LDADD = $(libdw) $(libelf) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) $(demanglelib)
+elfcmp_LDADD = $(libebl) $(libelf) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+objdump_LDADD = $(libasm) $(libebl) $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+ranlib_LDADD = libar.a $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
+strings_LDADD = $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
+ar_LDADD = libar.a $(libelf) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
+unstrip_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl
+stack_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD) -ldl \
+		$(demanglelib)
+
+elfcompress_LDADD = $(libebl) $(libelf) $(libdw) $(libeu) $(argp_LDADD) $(fts_LDADD) $(obstack_LDADD)
 ldlex_no_Werror = yes
 
 # Machine-specific linker code.
diff -ru elfutils-0.165.orig/src/addr2line.c elfutils-0.165/src/addr2line.c
--- elfutils-0.165.orig/src/addr2line.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/addr2line.c	2016-01-18 15:28:33.252193069 -0500
@@ -23,7 +23,7 @@
 #include <argp.h>
 #include <assert.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <inttypes.h>
 #include <libdwfl.h>
diff -ru elfutils-0.165.orig/src/ar.c elfutils-0.165/src/ar.c
--- elfutils-0.165.orig/src/ar.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/ar.c	2016-01-18 15:28:33.131194163 -0500
@@ -22,7 +22,7 @@
 
 #include <argp.h>
 #include <assert.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <libintl.h>
diff -ru elfutils-0.165.orig/src/arlib.c elfutils-0.165/src/arlib.c
--- elfutils-0.165.orig/src/arlib.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/src/arlib.c	2016-01-18 15:28:33.655189425 -0500
@@ -21,7 +21,7 @@
 #endif
 
 #include <assert.h>
-#include <error.h>
+#include "system.h"
 #include <gelf.h>
 #include <libintl.h>
 #include <stdio.h>
diff -ru elfutils-0.165.orig/src/arlib.h elfutils-0.165/src/arlib.h
--- elfutils-0.165.orig/src/arlib.h	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/src/arlib.h	2016-01-18 00:59:11.654185951 -0500
@@ -29,6 +29,16 @@
 #include <stdint.h>
 #include <sys/types.h>
 
+#if !defined(ACCESSPERMS)
+# define ACCESSPERMS (S_IRWXU|S_IRWXG|S_IRWXO) /* 0777 */
+#endif
+#if !defined(ALLPERMS)
+# define ALLPERMS (S_ISUID|S_ISGID|S_ISVTX|S_IRWXU|S_IRWXG|S_IRWXO) /* 07777 */
+#endif
+#if !defined(DEFFILEMODE)
+# define DEFFILEMODE (S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH)/* 0666*/
+#endif
+
 
 /* State of -D/-U flags.  */
 extern bool arlib_deterministic_output;
diff -ru elfutils-0.165.orig/src/arlib2.c elfutils-0.165/src/arlib2.c
--- elfutils-0.165.orig/src/arlib2.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/src/arlib2.c	2016-01-18 15:28:33.423191523 -0500
@@ -20,7 +20,7 @@
 # include <config.h>
 #endif
 
-#include <error.h>
+#include "system.h"
 #include <libintl.h>
 #include <limits.h>
 #include <string.h>
diff -ru elfutils-0.165.orig/src/elfcmp.c elfutils-0.165/src/elfcmp.c
--- elfutils-0.165.orig/src/elfcmp.c	2016-01-02 14:50:03.000000000 -0500
+++ elfutils-0.165/src/elfcmp.c	2016-01-18 15:28:33.394191785 -0500
@@ -23,7 +23,7 @@
 #include <argp.h>
 #include <assert.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <locale.h>
 #include <libintl.h>
diff -ru elfutils-0.165.orig/src/elfcompress.c elfutils-0.165/src/elfcompress.c
--- elfutils-0.165.orig/src/elfcompress.c	2016-01-08 10:14:40.000000000 -0500
+++ elfutils-0.165/src/elfcompress.c	2016-01-18 15:28:33.423191523 -0500
@@ -18,7 +18,7 @@
 #include <config.h>
 #include <assert.h>
 #include <argp.h>
-#include <error.h>
+#include "system.h"
 #include <stdbool.h>
 #include <stdlib.h>
 #include <inttypes.h>
@@ -47,6 +47,14 @@
 static bool permissive = false;
 static const char *foutput = NULL;
 
+#ifndef FNM_EXTMATCH
+#define FNM_EXTMATCH 0
+#endif
+
+#ifndef ALLPERMS
+#define ALLPERMS (S_ISUID|S_ISGID|S_ISVTX|S_IRWXU|S_IRWXG|S_IRWXO)/* 07777 */
+#endif
+
 #define T_UNSET 0
 #define T_DECOMPRESS 1    /* none */
 #define T_COMPRESS_ZLIB 2 /* zlib */
diff -ru elfutils-0.165.orig/src/elflint.c elfutils-0.165/src/elflint.c
--- elfutils-0.165.orig/src/elflint.c	2016-01-08 07:27:15.000000000 -0500
+++ elfutils-0.165/src/elflint.c	2016-01-18 15:28:33.166193846 -0500
@@ -24,7 +24,7 @@
 #include <assert.h>
 #include <byteswap.h>
 #include <endian.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <inttypes.h>
diff -ru elfutils-0.165.orig/src/findtextrel.c elfutils-0.165/src/findtextrel.c
--- elfutils-0.165.orig/src/findtextrel.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/findtextrel.c	2016-01-18 15:28:33.601189913 -0500
@@ -23,7 +23,7 @@
 #include <argp.h>
 #include <assert.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <libdw.h>
diff -ru elfutils-0.165.orig/src/i386_ld.c elfutils-0.165/src/i386_ld.c
--- elfutils-0.165.orig/src/i386_ld.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/src/i386_ld.c	2016-01-18 15:28:33.478191025 -0500
@@ -20,7 +20,7 @@
 #endif
 
 #include <assert.h>
-#include <error.h>
+#include "system.h"
 #include <libintl.h>
 #include <stdlib.h>
 #include <string.h>
diff -ru elfutils-0.165.orig/src/ld.c elfutils-0.165/src/ld.c
--- elfutils-0.165.orig/src/ld.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/ld.c	2016-01-18 15:28:33.194193593 -0500
@@ -21,7 +21,7 @@
 
 #include <argp.h>
 #include <assert.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <libelf.h>
 #include <libintl.h>
diff -ru elfutils-0.165.orig/src/ld.h elfutils-0.165/src/ld.h
--- elfutils-0.165.orig/src/ld.h	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/src/ld.h	2016-01-18 00:59:11.655185942 -0500
@@ -24,6 +24,19 @@
 #include <stdio.h>
 #include "xelf.h"
 
+#if !defined(DL_CALL_FCT)
+# define DL_CALL_FCT(fctp, args) (*fctp) args
+#endif	/* !defined(DL_CALL_FCT) */
+
+#if !defined(ACCESSPERMS)
+# define ACCESSPERMS (S_IRWXU|S_IRWXG|S_IRWXO) /* 0777 */
+#endif
+#if !defined(ALLPERMS)
+# define ALLPERMS (S_ISUID|S_ISGID|S_ISVTX|S_IRWXU|S_IRWXG|S_IRWXO) /* 07777 */
+#endif
+#if !defined(DEFFILEMODE)
+# define DEFFILEMODE (S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH)/* 0666*/
+#endif
 
 /* Recommended size of the buffer passed to ld_strerror.  */
 #define ERRBUFSIZE	(512)
diff -ru elfutils-0.165.orig/src/ldgeneric.c elfutils-0.165/src/ldgeneric.c
--- elfutils-0.165.orig/src/ldgeneric.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/src/ldgeneric.c	2016-01-18 15:28:33.544190429 -0500
@@ -23,7 +23,7 @@
 #include <ctype.h>
 #include <dlfcn.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <fnmatch.h>
 #include <gelf.h>
@@ -2628,12 +2628,12 @@
 }
 
 
-/* Callback function registered with on_exit to make sure the temporary
+/* Callback function registered with atexit to make sure the temporary
    files gets removed if something goes wrong.  */
 static void
-remove_tempfile (int status, void *arg)
+remove_tempfile (void)
 {
-  if (status != 0 && ld_state.tempfname != NULL)
+  if (error_message_count != 0 && ld_state.tempfname != NULL)
     unlink (ld_state.tempfname);
 }
 
@@ -2680,7 +2680,7 @@
 
   /* Make sure we remove the temporary file in case something goes
      wrong.  */
-  on_exit (remove_tempfile, NULL);
+  atexit (remove_tempfile);
 
   /* Create the ELF file data for the output file.  */
   Elf *elf = ld_state.outelf = elf_begin (fd,
diff -ru elfutils-0.165.orig/src/ldlex.c elfutils-0.165/src/ldlex.c
--- elfutils-0.165.orig/src/ldlex.c	2016-01-11 02:47:44.000000000 -0500
+++ elfutils-0.165/src/ldlex.c	2016-01-18 15:28:33.312192526 -0500
@@ -1106,7 +1106,7 @@
 #include <assert.h>
 #include <ctype.h>
 #include <elf.h>
-#include <error.h>
+#include "system.h"
 #include <inttypes.h>
 #include <libintl.h>
 #include <stdbool.h>
diff -ru elfutils-0.165.orig/src/ldlex.l elfutils-0.165/src/ldlex.l
--- elfutils-0.165.orig/src/ldlex.l	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/ldlex.l	2016-01-18 15:28:33.449191287 -0500
@@ -23,7 +23,7 @@
 #include <assert.h>
 #include <ctype.h>
 #include <elf.h>
-#include <error.h>
+#include "system.h"
 #include <inttypes.h>
 #include <libintl.h>
 #include <stdbool.h>
diff -ru elfutils-0.165.orig/src/ldscript.c elfutils-0.165/src/ldscript.c
--- elfutils-0.165.orig/src/ldscript.c	2016-01-11 02:47:44.000000000 -0500
+++ elfutils-0.165/src/ldscript.c	2016-01-18 15:28:33.575190148 -0500
@@ -95,7 +95,7 @@
 #endif
 
 #include <assert.h>
-#include <error.h>
+#include "system.h"
 #include <libintl.h>
 #include <stdbool.h>
 #include <stdint.h>
diff -ru elfutils-0.165.orig/src/ldscript.y elfutils-0.165/src/ldscript.y
--- elfutils-0.165.orig/src/ldscript.y	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/ldscript.y	2016-01-18 15:28:33.366192038 -0500
@@ -22,7 +22,7 @@
 #endif
 
 #include <assert.h>
-#include <error.h>
+#include "system.h"
 #include <libintl.h>
 #include <stdbool.h>
 #include <stdint.h>
diff -ru elfutils-0.165.orig/src/nm.c elfutils-0.165/src/nm.c
--- elfutils-0.165.orig/src/nm.c	2016-01-02 14:50:03.000000000 -0500
+++ elfutils-0.165/src/nm.c	2016-01-18 15:28:33.281192807 -0500
@@ -26,7 +26,7 @@
 #include <ctype.h>
 #include <dwarf.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <inttypes.h>
@@ -47,6 +47,21 @@
 #include "../libebl/libeblP.h"
 #include "../libdwfl/libdwflP.h"
 
+#if !defined(__GLIBC__)
+static int obstack_printf(struct obstack *obst, const char *fmt, ...)
+{
+	char buf[1024];
+	va_list ap;
+	int len;
+
+	va_start(ap, fmt);
+	len = vsnprintf(buf, sizeof(buf), fmt, ap);
+	obstack_grow(obst, buf, len);
+	va_end(ap);
+
+	return len;
+}
+#endif
 
 /* Name and version of program.  */
 static void print_version (FILE *stream, struct argp_state *state);
diff -ru elfutils-0.165.orig/src/objdump.c elfutils-0.165/src/objdump.c
--- elfutils-0.165.orig/src/objdump.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/objdump.c	2016-01-18 15:28:33.628189669 -0500
@@ -21,7 +21,7 @@
 #endif
 
 #include <argp.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <inttypes.h>
 #include <libintl.h>
diff -ru elfutils-0.165.orig/src/ranlib.c elfutils-0.165/src/ranlib.c
--- elfutils-0.165.orig/src/ranlib.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/ranlib.c	2016-01-18 15:28:33.682189181 -0500
@@ -24,7 +24,7 @@
 #include <argp.h>
 #include <assert.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <libintl.h>
diff -ru elfutils-0.165.orig/src/readelf.c elfutils-0.165/src/readelf.c
--- elfutils-0.165.orig/src/readelf.c	2016-01-08 10:15:02.000000000 -0500
+++ elfutils-0.165/src/readelf.c	2016-01-18 15:28:33.754188530 -0500
@@ -25,7 +25,7 @@
 #include <ctype.h>
 #include <dwarf.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <inttypes.h>
@@ -4474,10 +4474,11 @@
   return base;
 }
 
+static const char *listptr_name;
+
 static int
-compare_listptr (const void *a, const void *b, void *arg)
+compare_listptr (const void *a, const void *b)
 {
-  const char *name = arg;
   struct listptr *p1 = (void *) a;
   struct listptr *p2 = (void *) b;
 
@@ -4493,21 +4494,21 @@
 	  p1->warned = p2->warned = true;
 	  error (0, 0,
 		 gettext ("%s %#" PRIx64 " used with different address sizes"),
-		 name, (uint64_t) p1->offset);
+		 listptr_name, (uint64_t) p1->offset);
 	}
       if (p1->dwarf64 != p2->dwarf64)
 	{
 	  p1->warned = p2->warned = true;
 	  error (0, 0,
 		 gettext ("%s %#" PRIx64 " used with different offset sizes"),
-		 name, (uint64_t) p1->offset);
+		 listptr_name, (uint64_t) p1->offset);
 	}
       if (listptr_base (p1) != listptr_base (p2))
 	{
 	  p1->warned = p2->warned = true;
 	  error (0, 0,
 		 gettext ("%s %#" PRIx64 " used with different base addresses"),
-		 name, (uint64_t) p1->offset);
+		 listptr_name, (uint64_t) p1->offset);
 	}
     }
 
@@ -4572,9 +4573,11 @@
 static void
 sort_listptr (struct listptr_table *table, const char *name)
 {
-  if (table->n > 0)
-    qsort_r (table->table, table->n, sizeof table->table[0],
-	     &compare_listptr, (void *) name);
+  if (table->n > 0) {
+    listptr_name = name;
+    qsort (table->table, table->n, sizeof table->table[0],
+	     &compare_listptr);
+  }
 }
 
 static bool
diff -ru elfutils-0.165.orig/src/size.c elfutils-0.165/src/size.c
--- elfutils-0.165.orig/src/size.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/size.c	2016-01-18 15:28:33.102194425 -0500
@@ -21,7 +21,7 @@
 #endif
 
 #include <argp.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <inttypes.h>
diff -ru elfutils-0.165.orig/src/stack.c elfutils-0.165/src/stack.c
--- elfutils-0.165.orig/src/stack.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/stack.c	2016-01-18 15:28:33.505190781 -0500
@@ -18,7 +18,7 @@
 #include <config.h>
 #include <assert.h>
 #include <argp.h>
-#include <error.h>
+#include "system.h"
 #include <stdlib.h>
 #include <inttypes.h>
 #include <stdio.h>
diff -ru elfutils-0.165.orig/src/strings.c elfutils-0.165/src/strings.c
--- elfutils-0.165.orig/src/strings.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/strings.c	2016-01-18 15:28:33.339192282 -0500
@@ -25,7 +25,7 @@
 #include <ctype.h>
 #include <endian.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <inttypes.h>
diff -ru elfutils-0.165.orig/src/strip.c elfutils-0.165/src/strip.c
--- elfutils-0.165.orig/src/strip.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/src/strip.c	2016-01-18 15:28:33.225193313 -0500
@@ -24,7 +24,7 @@
 #include <assert.h>
 #include <byteswap.h>
 #include <endian.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <libelf.h>
@@ -44,6 +44,10 @@
 #include <libebl.h>
 #include <system.h>
 
+#if !defined(ACCESSPERMS)
+#define ACCESSPERMS (S_IRWXU|S_IRWXG|S_IRWXO)
+#endif
+
 typedef uint8_t GElf_Byte;
 
 /* Name and version of program.  */
diff -ru elfutils-0.165.orig/src/unstrip.c elfutils-0.165/src/unstrip.c
--- elfutils-0.165.orig/src/unstrip.c	2016-01-02 14:50:03.000000000 -0500
+++ elfutils-0.165/src/unstrip.c	2016-01-18 15:28:33.713188900 -0500
@@ -31,7 +31,7 @@
 #include <argp.h>
 #include <assert.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <fnmatch.h>
 #include <libintl.h>
diff -ru elfutils-0.165.orig/tests/Makefile.in elfutils-0.165/tests/Makefile.in
--- elfutils-0.165.orig/tests/Makefile.in	2016-01-11 02:45:46.000000000 -0500
+++ elfutils-0.165/tests/Makefile.in	2016-01-18 01:00:25.696516422 -0500
@@ -935,6 +935,7 @@
 dvidir = @dvidir@
 eu_version = @eu_version@
 exec_prefix = @exec_prefix@
+fts_LDADD = @fts_LDADD@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
@@ -950,6 +951,7 @@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
+obstack_LDADD = @obstack_LDADD@
 oldincludedir = @oldincludedir@
 pdfdir = @pdfdir@
 prefix = @prefix@
diff -ru elfutils-0.165.orig/tests/addrscopes.c elfutils-0.165/tests/addrscopes.c
--- elfutils-0.165.orig/tests/addrscopes.c	2016-01-02 14:50:03.000000000 -0500
+++ elfutils-0.165/tests/addrscopes.c	2016-01-18 15:28:33.977186513 -0500
@@ -25,7 +25,7 @@
 #include <stdio_ext.h>
 #include <locale.h>
 #include <stdlib.h>
-#include <error.h>
+#include "system.h"
 #include <string.h>
 
 
diff -ru elfutils-0.165.orig/tests/allregs.c elfutils-0.165/tests/allregs.c
--- elfutils-0.165.orig/tests/allregs.c	2016-01-02 14:50:03.000000000 -0500
+++ elfutils-0.165/tests/allregs.c	2016-01-18 15:28:34.194184551 -0500
@@ -21,7 +21,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <error.h>
+#include "system.h"
 #include <locale.h>
 #include <argp.h>
 #include <assert.h>
diff -ru elfutils-0.165.orig/tests/backtrace-data.c elfutils-0.165/tests/backtrace-data.c
--- elfutils-0.165.orig/tests/backtrace-data.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/backtrace-data.c	2016-01-18 15:28:34.139185048 -0500
@@ -27,7 +27,7 @@
 #include <dirent.h>
 #include <stdlib.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <unistd.h>
 #include <dwarf.h>
 #if defined(__x86_64__) && defined(__linux__)
diff -ru elfutils-0.165.orig/tests/backtrace-dwarf.c elfutils-0.165/tests/backtrace-dwarf.c
--- elfutils-0.165.orig/tests/backtrace-dwarf.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/backtrace-dwarf.c	2016-01-18 15:28:34.221184307 -0500
@@ -22,7 +22,7 @@
 #include <stdio_ext.h>
 #include <locale.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <unistd.h>
 #include <sys/ptrace.h>
 #include <sys/types.h>
diff -ru elfutils-0.165.orig/tests/backtrace.c elfutils-0.165/tests/backtrace.c
--- elfutils-0.165.orig/tests/backtrace.c	2015-12-01 10:36:26.000000000 -0500
+++ elfutils-0.165/tests/backtrace.c	2016-01-18 15:28:34.060185763 -0500
@@ -24,7 +24,7 @@
 #include <dirent.h>
 #include <stdlib.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <unistd.h>
 #include <dwarf.h>
 #ifdef __linux__
diff -ru elfutils-0.165.orig/tests/buildid.c elfutils-0.165/tests/buildid.c
--- elfutils-0.165.orig/tests/buildid.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/buildid.c	2016-01-18 15:28:34.004186269 -0500
@@ -23,7 +23,7 @@
 #include ELFUTILS_HEADER(elf)
 #include ELFUTILS_HEADER(dwelf)
 #include <stdio.h>
-#include <error.h>
+#include "system.h"
 #include <string.h>
 #include <stdlib.h>
 #include <sys/types.h>
diff -ru elfutils-0.165.orig/tests/debugaltlink.c elfutils-0.165/tests/debugaltlink.c
--- elfutils-0.165.orig/tests/debugaltlink.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/debugaltlink.c	2016-01-18 15:28:34.113185284 -0500
@@ -23,7 +23,7 @@
 #include ELFUTILS_HEADER(dw)
 #include ELFUTILS_HEADER(dwelf)
 #include <stdio.h>
-#include <error.h>
+#include "system.h"
 #include <string.h>
 #include <stdlib.h>
 #include <sys/types.h>
diff -ru elfutils-0.165.orig/tests/debuglink.c elfutils-0.165/tests/debuglink.c
--- elfutils-0.165.orig/tests/debuglink.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/debuglink.c	2016-01-18 15:28:34.087185519 -0500
@@ -21,7 +21,7 @@
 #include <errno.h>
 #include ELFUTILS_HEADER(dwelf)
 #include <stdio.h>
-#include <error.h>
+#include "system.h"
 #include <string.h>
 #include <stdlib.h>
 #include <sys/types.h>
diff -ru elfutils-0.165.orig/tests/deleted.c elfutils-0.165/tests/deleted.c
--- elfutils-0.165.orig/tests/deleted.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/deleted.c	2016-01-18 15:28:34.140185039 -0500
@@ -21,7 +21,7 @@
 #include <unistd.h>
 #include <assert.h>
 #include <stdio.h>
-#include <error.h>
+#include "system.h"
 #include <errno.h>
 #ifdef __linux__
 #include <sys/prctl.h>
diff -ru elfutils-0.165.orig/tests/dwfl-addr-sect.c elfutils-0.165/tests/dwfl-addr-sect.c
--- elfutils-0.165.orig/tests/dwfl-addr-sect.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/dwfl-addr-sect.c	2016-01-18 15:28:34.168184786 -0500
@@ -23,7 +23,7 @@
 #include <stdio_ext.h>
 #include <stdlib.h>
 #include <string.h>
-#include <error.h>
+#include "system.h"
 #include <locale.h>
 #include <argp.h>
 #include ELFUTILS_HEADER(dwfl)
diff -ru elfutils-0.165.orig/tests/dwfl-bug-addr-overflow.c elfutils-0.165/tests/dwfl-bug-addr-overflow.c
--- elfutils-0.165.orig/tests/dwfl-bug-addr-overflow.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/dwfl-bug-addr-overflow.c	2016-01-18 15:28:34.005186260 -0500
@@ -20,7 +20,7 @@
 #include <inttypes.h>
 #include <stdio.h>
 #include <stdio_ext.h>
-#include <error.h>
+#include "system.h"
 #include <locale.h>
 #include ELFUTILS_HEADER(dwfl)
 
diff -ru elfutils-0.165.orig/tests/dwfl-bug-fd-leak.c elfutils-0.165/tests/dwfl-bug-fd-leak.c
--- elfutils-0.165.orig/tests/dwfl-bug-fd-leak.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/dwfl-bug-fd-leak.c	2016-01-18 15:28:34.140185039 -0500
@@ -24,7 +24,7 @@
 #include <dirent.h>
 #include <stdlib.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <unistd.h>
 #include <dwarf.h>
 #include <sys/resource.h>
diff -ru elfutils-0.165.orig/tests/dwfl-bug-getmodules.c elfutils-0.165/tests/dwfl-bug-getmodules.c
--- elfutils-0.165.orig/tests/dwfl-bug-getmodules.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/dwfl-bug-getmodules.c	2016-01-18 15:28:33.951186748 -0500
@@ -18,7 +18,7 @@
 #include <config.h>
 #include ELFUTILS_HEADER(dwfl)
 
-#include <error.h>
+#include "system.h"
 
 static const Dwfl_Callbacks callbacks =
   {
diff -ru elfutils-0.165.orig/tests/dwfl-proc-attach.c elfutils-0.165/tests/dwfl-proc-attach.c
--- elfutils-0.165.orig/tests/dwfl-proc-attach.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/dwfl-proc-attach.c	2016-01-18 15:28:34.275183819 -0500
@@ -20,7 +20,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <unistd.h>
 #include <sys/types.h>
 #include <sys/stat.h>
diff -ru elfutils-0.165.orig/tests/dwfl-report-elf-align.c elfutils-0.165/tests/dwfl-report-elf-align.c
--- elfutils-0.165.orig/tests/dwfl-report-elf-align.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/dwfl-report-elf-align.c	2016-01-18 15:28:34.275183819 -0500
@@ -20,7 +20,7 @@
 #include <inttypes.h>
 #include <stdio.h>
 #include <stdio_ext.h>
-#include <error.h>
+#include "system.h"
 #include <locale.h>
 #include <string.h>
 #include <stdlib.h>
diff -ru elfutils-0.165.orig/tests/dwfllines.c elfutils-0.165/tests/dwfllines.c
--- elfutils-0.165.orig/tests/dwfllines.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/dwfllines.c	2016-01-18 15:28:34.086185528 -0500
@@ -27,7 +27,7 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <error.h>
+#include "system.h"
 
 int
 main (int argc, char *argv[])
diff -ru elfutils-0.165.orig/tests/dwflmodtest.c elfutils-0.165/tests/dwflmodtest.c
--- elfutils-0.165.orig/tests/dwflmodtest.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/dwflmodtest.c	2016-01-18 15:28:34.274183828 -0500
@@ -23,7 +23,7 @@
 #include <stdio_ext.h>
 #include <stdlib.h>
 #include <string.h>
-#include <error.h>
+#include "system.h"
 #include <locale.h>
 #include <argp.h>
 #include ELFUTILS_HEADER(dwfl)
diff -ru elfutils-0.165.orig/tests/dwflsyms.c elfutils-0.165/tests/dwflsyms.c
--- elfutils-0.165.orig/tests/dwflsyms.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/dwflsyms.c	2016-01-18 15:28:34.004186269 -0500
@@ -25,7 +25,7 @@
 #include <stdio.h>
 #include <stdio_ext.h>
 #include <stdlib.h>
-#include <error.h>
+#include "system.h"
 #include <string.h>
 
 static const char *
diff -ru elfutils-0.165.orig/tests/early-offscn.c elfutils-0.165/tests/early-offscn.c
--- elfutils-0.165.orig/tests/early-offscn.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/early-offscn.c	2016-01-18 15:28:34.168184786 -0500
@@ -19,7 +19,7 @@
 #endif
 
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <stdio.h>
diff -ru elfutils-0.165.orig/tests/ecp.c elfutils-0.165/tests/ecp.c
--- elfutils-0.165.orig/tests/ecp.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/ecp.c	2016-01-18 15:28:33.977186513 -0500
@@ -20,7 +20,7 @@
 #endif
 
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <stdlib.h>
diff -ru elfutils-0.165.orig/tests/elfstrmerge.c elfutils-0.165/tests/elfstrmerge.c
--- elfutils-0.165.orig/tests/elfstrmerge.c	2016-01-08 07:27:15.000000000 -0500
+++ elfutils-0.165/tests/elfstrmerge.c	2016-01-18 15:28:34.168184786 -0500
@@ -24,7 +24,7 @@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
-#include <error.h>
+#include "system.h"
 #include <stdio.h>
 #include <inttypes.h>
 #include <unistd.h>
diff -ru elfutils-0.165.orig/tests/find-prologues.c elfutils-0.165/tests/find-prologues.c
--- elfutils-0.165.orig/tests/find-prologues.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/find-prologues.c	2016-01-18 15:28:34.086185528 -0500
@@ -25,7 +25,7 @@
 #include <stdio_ext.h>
 #include <locale.h>
 #include <stdlib.h>
-#include <error.h>
+#include "system.h"
 #include <string.h>
 #include <fnmatch.h>
 
diff -ru elfutils-0.165.orig/tests/funcretval.c elfutils-0.165/tests/funcretval.c
--- elfutils-0.165.orig/tests/funcretval.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/funcretval.c	2016-01-18 15:28:34.195184542 -0500
@@ -25,7 +25,7 @@
 #include <stdio_ext.h>
 #include <locale.h>
 #include <stdlib.h>
-#include <error.h>
+#include "system.h"
 #include <string.h>
 #include <fnmatch.h>
 
diff -ru elfutils-0.165.orig/tests/funcscopes.c elfutils-0.165/tests/funcscopes.c
--- elfutils-0.165.orig/tests/funcscopes.c	2016-01-02 14:50:03.000000000 -0500
+++ elfutils-0.165/tests/funcscopes.c	2016-01-18 15:28:34.301183584 -0500
@@ -25,7 +25,7 @@
 #include <stdio_ext.h>
 #include <locale.h>
 #include <stdlib.h>
-#include <error.h>
+#include "system.h"
 #include <string.h>
 #include <fnmatch.h>
 
diff -ru elfutils-0.165.orig/tests/getsrc_die.c elfutils-0.165/tests/getsrc_die.c
--- elfutils-0.165.orig/tests/getsrc_die.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/getsrc_die.c	2016-01-18 15:28:34.275183819 -0500
@@ -19,7 +19,7 @@
 #endif
 
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <inttypes.h>
 #include <libelf.h>
diff -ru elfutils-0.165.orig/tests/line2addr.c elfutils-0.165/tests/line2addr.c
--- elfutils-0.165.orig/tests/line2addr.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/line2addr.c	2016-01-18 15:28:34.302183575 -0500
@@ -26,7 +26,7 @@
 #include <locale.h>
 #include <stdlib.h>
 #include <string.h>
-#include <error.h>
+#include "system.h"
 
 
 static void
diff -ru elfutils-0.165.orig/tests/low_high_pc.c elfutils-0.165/tests/low_high_pc.c
--- elfutils-0.165.orig/tests/low_high_pc.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/low_high_pc.c	2016-01-18 15:28:34.248184063 -0500
@@ -25,7 +25,7 @@
 #include <stdio_ext.h>
 #include <locale.h>
 #include <stdlib.h>
-#include <error.h>
+#include "system.h"
 #include <string.h>
 #include <fnmatch.h>
 
diff -ru elfutils-0.165.orig/tests/md5-sha1-test.c elfutils-0.165/tests/md5-sha1-test.c
--- elfutils-0.165.orig/tests/md5-sha1-test.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/md5-sha1-test.c	2016-01-18 15:28:34.275183819 -0500
@@ -19,7 +19,7 @@
 #endif
 
 #include <string.h>
-#include <error.h>
+#include "system.h"
 
 #include "md5.h"
 #include "sha1.h"
diff -ru elfutils-0.165.orig/tests/rdwrmmap.c elfutils-0.165/tests/rdwrmmap.c
--- elfutils-0.165.orig/tests/rdwrmmap.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/rdwrmmap.c	2016-01-18 15:28:34.194184551 -0500
@@ -19,7 +19,7 @@
 #endif
 
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <stdio.h>
 #include <fcntl.h>
 #include <unistd.h>
diff -ru elfutils-0.165.orig/tests/saridx.c elfutils-0.165/tests/saridx.c
--- elfutils-0.165.orig/tests/saridx.c	2015-08-21 08:22:37.000000000 -0400
+++ elfutils-0.165/tests/saridx.c	2016-01-18 15:28:34.353183113 -0500
@@ -17,7 +17,7 @@
 
 #include <config.h>
 
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <stdio.h>
diff -ru elfutils-0.165.orig/tests/sectiondump.c elfutils-0.165/tests/sectiondump.c
--- elfutils-0.165.orig/tests/sectiondump.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/sectiondump.c	2016-01-18 15:28:34.247184072 -0500
@@ -18,7 +18,7 @@
 #include <config.h>
 
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <fcntl.h>
 #include <gelf.h>
 #include <inttypes.h>
diff -ru elfutils-0.165.orig/tests/varlocs.c elfutils-0.165/tests/varlocs.c
--- elfutils-0.165.orig/tests/varlocs.c	2015-12-01 07:23:22.000000000 -0500
+++ elfutils-0.165/tests/varlocs.c	2016-01-18 15:28:34.033186007 -0500
@@ -25,7 +25,7 @@
 #include <dwarf.h>
 #include <stdio.h>
 #include <stdlib.h>
-#include <error.h>
+#include "system.h"
 #include <string.h>
 #include <sys/types.h>
 #include <sys/stat.h>
diff -ru elfutils-0.165.orig/tests/vdsosyms.c elfutils-0.165/tests/vdsosyms.c
--- elfutils-0.165.orig/tests/vdsosyms.c	2015-11-27 08:36:29.000000000 -0500
+++ elfutils-0.165/tests/vdsosyms.c	2016-01-18 15:28:34.087185519 -0500
@@ -18,7 +18,7 @@
 #include <config.h>
 #include <assert.h>
 #include <errno.h>
-#include <error.h>
+#include "system.h"
 #include <inttypes.h>
 #include <stdio.h>
 #include <string.h>
