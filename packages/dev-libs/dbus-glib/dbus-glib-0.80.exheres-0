# Copyright 2008 Bo Ã˜rsted Andresen <zlin@exherbo.org>
# Copyright 2009 Saleem Abdulrasool <compnerd@compnerd.org>
# Distributed under the terms of the GNU General Public License v2

require bash-completion

SUMMARY="D-Bus GLib Bindings"
HOMEPAGE="http://www.freedesktop.org/wiki/Software/DBusBindings"
DOWNLOADS="http://dbus.freedesktop.org/releases/${PN}/${PNV}.tar.gz"

LICENCES="|| ( GPL-2 AFL-2.1 )"
SLOT="1"
PLATFORMS="~amd64 ~ppc64 ~x86"
MYOPTIONS="bash-completion doc verbose"

DEPENDENCIES="
    build+run:
        dev-libs/glib:2[>=2.10]
        sys-apps/dbus[>=1.1]
        dev-libs/expat
    build:
        sys-devel/gettext
        dev-util/pkg-config[>=0.20]
        doc? ( dev-doc/gtk-doc[>=1.4] )
"

DEFAULT_SRC_CONFIGURE_PARAMS=( '--disable-tests' '--disable-doxygen-docs' )
DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( bash-completion 'doc gtk-doc' "verbose verbose-mode" )

src_configure() {
    CTARGET= default
}

src_install() {
    default

    if option bash-completion ; then
        dobashcompletion "${IMAGE}"/etc/bash_completion.d/dbus-bash-completion.sh dbus ||
            die "failed to put bashcomp in its place"
        rm "${IMAGE}"/etc/bash_completion.d/dbus-bash-completion.sh ||
            die "failed to remove bad bashcomp"
    else
        rmdir "${IMAGE}"/usr/libexec ||
            die "failed to prune empty dir"

    fi
    rmdir "${IMAGE}"/etc/{bash_completion.d,} ||
        die "failed to prune empty dirs"
}

