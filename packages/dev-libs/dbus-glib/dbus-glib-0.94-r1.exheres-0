# Copyright 2008 Bo Ã˜rsted Andresen <zlin@exherbo.org>
# Copyright 2009 Saleem Abdulrasool <compnerd@compnerd.org>
# Distributed under the terms of the GNU General Public License v2

require bash-completion easy-multibuild

SUMMARY="D-Bus GLib Bindings"
HOMEPAGE="http://www.freedesktop.org/wiki/Software/DBusBindings"
DOWNLOADS="http://dbus.freedesktop.org/releases/${PN}/${PNV}.tar.gz"

LICENCES="|| ( GPL-2 AFL-2.1 )"
SLOT="1"
PLATFORMS="~amd64 ~ppc64 ~x86"
MYOPTIONS="bash-completion doc verbose
    multibuild_c: 32 64"

DEPENDENCIES="
    build:
        sys-devel/gettext
        dev-util/pkg-config[>=0.9.0]
        doc? ( dev-doc/gtk-doc[>=1.4] )
    build+run:
        dev-libs/glib:2[>=2.26][multibuild_c:*(?)?]
        sys-apps/dbus[>=1.2.16][multibuild_c:*(?)?]
        dev-libs/expat[multibuild_c:*(?)?]
"

DEFAULT_SRC_PREPARE_PATCHES=( "${FILES}/${PNV}-marshall_objs.patch" )
DEFAULT_SRC_CONFIGURE_PARAMS=( '--disable-tests' )
DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( bash-completion 'doc gtk-doc' "verbose verbose-mode" )

src_configure() {
    edo mkdir "${WORK}/po"
    edo touch "${WORK}/po/POTFILES.in"

    easy-multibuild_src_configure
}

src_install() {
    easy-multibuild_src_install

    if option bash-completion ; then
        edo dobashcompletion "${IMAGE}"/etc/bash_completion.d/dbus-bash-completion.sh dbus
        edo rm "${IMAGE}"/etc/bash_completion.d/dbus-bash-completion.sh
    else
        edo rmdir "${IMAGE}"/usr/libexec
    fi

    edo rmdir "${IMAGE}"/etc/{bash_completion.d,}
}

