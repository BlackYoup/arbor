# Copyright 2009 Maxime Coste <frrrwww@gmail.com>
# Copyright 2014 Xavier Barrachina <xv.barrachina@gmail.com>
# Distributed under the terms of the GNU General Public License v2

require flag-o-matic

SUMMARY="C++ cryptographic library"
DESCRIPTION="
Crypto++ is a C++ class library containing various cryptographic schemes
"
HOMEPAGE="http://www.cryptopp.com"
DOWNLOADS="mirror://sourceforge/cryptopp/cryptopp${PV//./}.zip"

LICENCES="
    cryptopp
    Boost-1.0
"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS=""

WORK="${WORKBASE}"
RESTRICT=test

src_prepare() {
    edo sed -e "s:/lib:/${LIBDIR}:" \
            -e "s:lib64cryptopp:libcryptopp:" \
            -i GNUmakefile
}

src_compile() {
    # do not compile with more that -O1, crypto++ will produce incorrect
    # results
    replace-flags -O2 -O1
    emake CXXFLAGS="${CXXFLAGS} -fPIC"
    emake CXXFLAGS="${CXXFLAGS} -fPIC" libcryptopp.so
}

src_install() {
    emake PREFIX="${IMAGE}/usr/" install
    rm -r "${IMAGE}/usr/bin"

    # create the libcrypto++.so.9 needed by megasync
    edo cd "${IMAGE}/usr/${LIBDIR}"
    edo ln -s libcryptopp.so libcrypto++.so.9
}

