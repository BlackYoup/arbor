# Copyright 2007 Alexander Færøy <ahf@exherbo.org>
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'libpcap-0.9.8.ebuild' from Gentoo, which is:
#     Copyright 1999-2007 Gentoo Foundation

SUMMARY="A library for network packet capturing"
HOMEPAGE="http://www.tcpdump.org"
DOWNLOADS="${HOMEPAGE}/release/${PNV}.tar.gz"

REMOTE_IDS="freecode:${PN}"

LICENCES="BSD-3"
SLOT="0"
PLATFORMS="~amd64 ~arm ~x86"
MYOPTIONS="
    bluetooth
    canusb [[ description = [ Use libusb to support CAN bus sniffing via CANUSB devices ] ]]
    dbus
    nl80211 [[ description = [ Support monitor mode on nl80211 devices ] ]]
"

DEPENDENCIES="
    build:
        sys-devel/bison
        sys-devel/flex
        dbus? ( virtual/pkg-config )
    build+run:
        bluetooth? ( net-wireless/bluez[<5] )
        canusb? ( virtual/usb:1 )
        dbus? ( sys-apps/dbus[>=1.0.0] )
        nl80211? ( net-libs/libnl:3.0 )
"

DEFAULT_SRC_INSTALL_EXCLUDE=( README.{Win32,aix,dag,hpux,macosx,septel,sita,tru64} )

src_configure() {
    local SRC_CONFIGURE_PARAMS=(
        --enable-can
        --enable-ipv6
        --enable-packet-ring
        --enable-usb
        --without-dag
        --without-septel
        --without-snf
        $(option_enable bluetooth)
        $(option_enable canusb)
        $(option_enable dbus)
        $(option nl80211 && echo --with-libnl= || echo --without-libnl)
    )
    econf "${SRC_CONFIGURE_PARAMS[@]}"
}
