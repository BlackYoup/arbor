# Copyright (c) 2007 Alexander Færøy <ahf@exherbo.org>
# Distributed under the terms of the GNU General Public License v2
#
# This is highly inspired from Gentoo's ebuild which is:
#   Copyright 1999-2007 Gentoo Foundation
#

require multilib toolchain-funcs

SUMMARY="A library for network packet capturing"
HOMEPAGE="http://www.tcpdump.org/"
DOWNLOADS="http://www.tcpdump.org/release/${PNV}.tar.gz"

LICENCES="BSD-3"
SLOT="0"
PLATFORMS="~amd64 ~ppc64 ~x86"
MYOPTIONS="ipv6"

DEPENDENCIES="
    build:
        sys-devel/bison
        sys-devel/flex"

DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( ipv6 )

src_compile() {
    default

    $(tc-getCC) ${LDFLAGS} -Wl,-soname,libpcap.so.0 -shared -fPIC -o libpcap.so.${PV:0:3} *.o || die "Unable to generate shared object file"
}

src_install() {
    default

    insopts -m 755
    insinto /usr/$(get_libdir)/
    doins libpcap.so.${PV:0:3}
    dosym libpcap.so.${PV:0:3} /usr/$(get_libdir)/libpcap.so.0
    dosym libpcap.so.${PV:0:3} /usr/$(get_libdir)/libpcap.so
}

