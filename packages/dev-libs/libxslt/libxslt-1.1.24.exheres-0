# Copyright 2008 Santiago M. Mola
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'libxslt-1.1.23.ebuild', which is:
#   Copyright 1999-2008 Gentoo Foundation

require multilib autotools

SUMMARY="XSLT libraries and tools"
HOMEPAGE="http://www.xmlsoft.org/XSLT/"
SRC_URI="ftp://xmlsoft.org/${PN}/${P}.tar.gz"

LICENSE="MIT"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS="crypt debug examples python"

DEPENDENCIES="
    build+run:
        >=dev-libs/libxml2-2.6.27
        crypt?  ( >=dev-libs/libgcrypt-1.1.92 )
        python? ( dev-lang/python:= )
"

DEFAULT_SRC_PREPARE_PATCHES=(
    -p0 "${FILESDIR}/libxslt.m4-${PN}-1.1.8.patch"
    -p3 "${FILESDIR}/${PN}-1.1.23-parallel-install.patch"
)

DEFAULT_SRC_INSTALL_EXTRA_DOCS="FEATURES"

src_prepare() {
    default

    # sed Makefile to fix bug Gentoo #99382 so that html gets installed in ${PF}
    sed -i -e "s:libxslt-\$(VERSION):${PF}:" doc/Makefile.am

    # Be warned: eautoreconf breaks tests
    eautomake
}

# Always pass --with-debugger. It is required by third parties (see
# e.g. Gentoo bug #98345)
DEFAULT_SRC_CONFIGURE_PARAMS=( --with-debugger )
DEFAULT_SRC_CONFIGURE_OPTION_WITHS=(
    "crypt crypto"
    debug
    "debug mem-debug"
    python
)

src_install() {
    default
    keepdir /usr/$(get_libdir)/libxslt-plugins

    if ! option examples; then
        rm -rf "${D}/usr/share/doc/${PN}-python-${PV}/examples"
    fi
}
