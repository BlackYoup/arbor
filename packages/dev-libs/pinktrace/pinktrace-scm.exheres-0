# Copyright 2010 Ali Polatel <alip@exherbo.org>
# Distributed under the terms of the GNU General Public License v2

require autotools [ supported_autoconf=[ 2.5 ] supported_automake=[ 1.11 1.10 ] ]

SUMMARY="Pink's Tracing Library"
DESCRIPTION="
pinktrace is a wrapper around ptrace(2) system call.
It provides a robust API for tracing processes.
Note this is a work in progress and the API is *not* stable.
"
HOMEPAGE="http://dev.exherbo.org/~alip/${PN}"
DOWNLOADS=""
SCM_REPOSITORY="git://github.com/alip/pinktrace.git"
require scm-git

LICENCES="BSD-3"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS="doc python ruby ipv6"

DEPENDENCIES="
    build:
        dev-libs/check
        doc? (
            app-doc/doxygen
            python? ( dev-python/epydoc )
        )
    build+run:
        python? ( dev-lang/python:= )
        ruby? ( dev-lang/ruby )
"

BUGS_TO="alip@exherbo.org"
UPSTREAM_DOCUMENTATION="
    ${HOMEPAGE}/api/c      [[ lang = en description = [ API documentation ] ]]
    ${HOMEPAGE}/api/python [[ lang = en description = [ Python bindings API documentation ] ]]
    ${HOMEPAGE}/api/ruby   [[ lang = en description = [ Ruby bindings API documentation ] ]]
"

AT_M4DIR=m4

src_test() {
    if ! sydboxcheck 2>/dev/null; then
        default
    else
        elog "Not running tests due to ptrace limitations"
        elog "set PALUDIS_DO_NOTHING_SANDBOXY=1 if you want to run the tests"
    fi
}

src_configure() {
    econf \
        $(option_enable doc doxygen) \
        $(option doc && option python && echo '--enable-python-doc') \
        $(option doc && option ruby && echo '--enable-ruby-doc') \
        $(option_enable ipv6) \
        $(option_enable python) \
        $(option_enable ruby)
}

