# Copyright 2008 Bernd Steinhauser <berniyh@exherbo.org>
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'rasqal-0.9.15.ebuild' from Gentoo, which is:
#     Copyright 1999-2008 Gentoo Foundation.


SUMMARY="library that handles Resource Description Framework (RDF)"
HOMEPAGE="http://librdf.org/rasqal"
SRC_URI="http://download.librdf.org/source/${P}.tar.gz"

LICENSE="|| ( LGPL-2.1 Apache-2.0 )"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS="debug gmp pcre xml"

DEPENDENCIES="
    build:
        dev-perl/XML-DOM
        dev-util/pkg-config
        sys-devel/flex
    build+run:
        media-libs/raptor
        gmp? ( dev-libs/gmp )
        !gmp? ( dev-libs/mpfr )
        pcre? ( dev-libs/libpcre )
        xml? ( dev-libs/libxml2 )"
#        debug? ( dev-libs/dmalloc )

src_prepare() {
    # This test fails because it passes, but a failure is expected.
    sed -e '/^str-2/d' -e '/^datatype-1/ s:\\$::' \
        -e '/^\"Equality - 2 var - test equals\"/d' \
        -e '/^EXPECTED.*_COUNT/ s:4:3:' \
        -i "${S}"/tests/sparql/Expr{Builtins,Equals}/Makefile.{am,in}\
        || die "Fixing tests failed."
    default
}

src_configure() {
    econf 
        $(option_enable pcre) \
        $(option_enable xml xml2) \
        $(option_enable debug maintainer-mode) \
        --with-regex-library=$(option pcre && echo "pcre" || echo "posix") \
        --with-decimal=$(option gmp && echo "gmp" || echo "mpfr") \
        --with-raptor=system

#        $(option_enable debug dmalloc) \
}

