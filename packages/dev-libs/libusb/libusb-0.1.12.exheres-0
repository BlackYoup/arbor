# Copyright 2008 Saleem Abdulrasool <compnerd@compnerd.org>
# Distributed under the terms of the GNU General Public License v2
# Based in part on 'libusb-0.1.12.ebuild' from Gentoo which is:
#    Copyright 1999-2007 Gentoo Foundation

require autotools [ supported_autoconf=[ 2.5 ] supported_automake=[ 1.10 ] ]

SUMMARY="Userspace access to USB devices"
HOMEPAGE="http://libusb.sourceforge.net/"
DOWNLOADS="mirror://sourceforge/${PN}/${PNV}.tar.gz"

LICENCES="LGPL-2"
SLOT="0.1"
PLATFORMS="~amd64 ~ppc64 ~x86"
MYOPTIONS="debug doc"

DEPENDENCIES="
    build:
        doc? (
            app-text/openjade
            app-text/docbook-dsssl-stylesheets
            app-text/docbook-sgml-utils
            app-text/docbook-sgml-dtd:4.2
        )"

# tests are not well encapsulated
RESTRICT="test"

DEFAULT_SRC_PREPARE_PATCHES=("${FILES}/${PNV}-circular-dependency-cxx.patch")

DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( "debug debug all" "doc build-docs" )

src_prepare() {
    default
    sed -i -e 's:-Werror::' Makefile.am || die "failed to remove -Werror"
    eautoreconf
}

src_install() {
    default

    if option doc ; then
        insinto /usr/share/doc/${PN}/html/
        dodoc doc/html/*.html
    fi
}

