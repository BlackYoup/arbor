# Copyright 2007 Bryan Ã˜stergaard
# Distributed under the terms of the GNU General Public License v2

SUMMARY="Apache portable runtime library"
HOMEPAGE="http://${PN}.apache.org/"
DOWNLOADS="mirror://apache/${PN}/${PNV}.tar.bz2"

REMOTE_IDS="freshmeat:${PN}"

LICENCES="Apache-2.0"
SLOT="1"
PLATFORMS="~amd64 ~ia64 ~ppc64 ~x86"
MYOPTIONS=""

DEPENDENCIES=""

DEFAULT_SRC_PREPARE_PATCHES=( "${FILES}"/${PN}-1.3.9-sydbox.patch )

src_configure() {
    # FIXME: Two more configure tests try to bind 0.0.0.0:0
    sydboxcmd "net/whitelist/bind/unix://${WORK}/apr_accept4_test_socket"
    default
    sydboxcmd "net/unwhitelist/bind/unix://${WORK}/apr_accept4_test_socket"

    # Make sure we use the system libtool
    edo sed -i -e 's,$(apr_builddir)/libtool,/usr/bin/libtool,' "${WORK}"/build/apr_rules.mk
    edo sed -i -e 's,${installbuilddir}/libtool,/usr/bin/libtool,' "${WORK}"/apr-1-config
    edo rm -f "${WORK}"/libtool
}

