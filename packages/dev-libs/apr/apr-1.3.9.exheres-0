# Copyright 2007 Bryan Ã˜stergaard
# Distributed under the terms of the GNU General Public License v2

SUMMARY="Apache portable runtime library"
HOMEPAGE="http://apr.apache.org/"
DOWNLOADS="mirror://apache/apr/${PNV}.tar.bz2"

LICENCES="Apache-2.0"
SLOT="1"
PLATFORMS="~amd64 ~ia64 ~ppc64 ~x86"
MYOPTIONS=""

DEPENDENCIES=""

DEFAULT_SRC_PREPARE_PATCHES=( "${FILES}"/${PNV}-sydbox.patch )
# Tests don't run in parallel
DEFAULT_SRC_TEST_PARAMS=( -j1 )

src_configure() {
    default

    # Make sure we use the system libtool
    sed -i 's,$(apr_builddir)/libtool,/usr/bin/libtool,' "${WORK}"/build/apr_rules.mk || die "sed1 failed"
    sed -i 's,${installbuilddir}/libtool,/usr/bin/libtool,' "${WORK}"/apr-1-config || die "sed2 failed"
    rm -f "${WORK}"/libtool
}

