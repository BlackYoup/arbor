# Copyright 2007 Bryan Ã˜stergaard <kloeri@exherbo.org>
# Copyright 2008 Saleem Abdulrasool <compnerd@compnerd.org>
# Distributed under the terms of the GNU General Public License v2

require glib autotools [ supported_autoconf=[ 2.5 ] supported_automake=[ 1.11 ] ]

SLOT="2"
PLATFORMS="~amd64 ~arm ~ia64 ~ppc64 ~x86"
MYOPTIONS="
    dbus [[ description = [ Build GDbus tests which require dbus ] ]]
    fam  [[ description = [ Enable FAM support for file system monitoring ] ]]
"

DEPENDENCIES="
    build:
        sys-devel/gettext[>=0.11]
        dev-doc/gtk-doc[>=1.15] [[ note = [ required for gtk-doc.m4 due to eautoreconf ] ]]
        dev-util/pkg-config[>=0.16]
    build+run:
        fam? ( app-admin/gamin[multibuild_c:*(?)?] )
    test:
        x11-misc/shared-mime-info
        dev-util/desktop-file-utils
        gnome-bindings/pygobject
        dev-python/dbus-python
        dbus? ( sys-apps/dbus[>=1.2.14] )
    recommendation:
        gnome-desktop/dconf [[ note = [ required for gsettings ] ]]
    suggestion:
        gnome-desktop/gvfs[multibuild_c:*(?)?]
"

DEFAULT_SRC_PREPARE_PATCHES=(
    "${FILES}"/${PN}-2.24.1-assert-test.patch
    "${FILES}"/${PNV}-optionalize-dbus-tests.patch
)
DEFAULT_SRC_CONFIGURE_PARAMS=( '--enable-static' '--disable-selinux' '--disable-xattr' '--with-pcre=internal' )
DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( fam )
DEFAULT_SRC_CONFIGURE_OPTION_WITHS=( dbus )

# eautoreconf required for dbus tests patch
src_prepare() {
    default
    eautoreconf
}

