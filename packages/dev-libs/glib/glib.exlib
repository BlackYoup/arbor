# Copyright 2008 Saleem Abdulrasool <compnerd@compnerd.org>
# Distributed under the terms of the GNU General Purpose License v2

require gnome.org easy-multibuild

SUMMARY="General purpose utility library"
DESCRIPTION="
GLib is a general-purpose utility library, which provides many useful data
types, macros, type conversions, string utilities, file utilities, a main loop
abstraction, and so on. It works on many UNIX-like platforms, Windows, OS/2 and
BeOS.  The general policy of GLib is that all functions are invisibly threadsafe
with the exception of data structure manipulation functions, where, if you have
two threads manipulating the same data structure, they must use a lock to
synchronize their operation.
"
HOMEPAGE="http://www.gtk.org"

MYOPTIONS="multibuild_c: 32 64"

LICENCES="LGPL-2"

REMOTE_IDS="freshmeat:glib"

install_one_multibuild() {
    default
    keepdir "/usr/${LIBDIR}/gio/modules"
}

glib_src_install() {
    easy-multibuild_src_install
}

test_one_multibuild() {
    unset DBUS_SESSION_BUS_ADDRESS

    export XDG_CONFIG_DIRS="/etc/xdg"
    export XDG_DATA_DIRS="/usr/share"
    export XDG_DATA_HOME="${TEMP}"

    # Requires 700 permissions and TEMP is 755
    export G_DBUS_COOKIE_SHA1_KEYRING_DIR_IGNORE_PERMISSION=1
    export G_DBUS_COOKIE_SHA1_KEYRING_DIR="${TEMP}"

    esandbox allow_net --connect 'unix:/tmp/g-dbus-tests-pid-*'
    esandbox allow_net 'unix:/tmp/g-dbus-tests-pid-*'
    esandbox allow_net --connect 'unix:/tmp/gdbus-test-does-not-exist-pid'
    esandbox allow_net 'unix-abstract:/tmp/gdbus-test-/dbus-*'

    default

    esandbox disallow_net --connect 'unix:/tmp/g-dbus-tests-pid-*'
    esandbox disallow_net 'unix:/tmp/g-dbus-tests-pid-*'
    esandbox disallow_net --connect 'unix:/tmp/gdbus-test-does-not-exist-pid'
    esandbox disallow_net 'unix-abstract:/tmp/gdbus-test-/dbus-*'
}

