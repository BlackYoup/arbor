# Copyright 2007 Bryan Ã˜stergaard
# Distributed under the terms of the GNU General Public License v2

SUMMARY="Open source SSL and TLS implementation and cryptographic library"
HOMEPAGE="http://www.openssl.org"
DOWNLOADS="http://www.openssl.org/source/${PNV}.tar.gz"

LICENCES="BSD"
SLOT="0"
PLATFORMS="~amd64 ~ia64 ~ppc64 ~x86"
MYOPTIONS="platform:ppc64"

DEPENDENCIES=""

src_prepare() {
    # Fix manpath
    sed -i 's:^MANDIR=.*$:MANDIR=/usr/share/man:' Makefile.org || die "sed failed"
}

src_configure() {
    ./config --test-sanity || die "Sanity test failed"

    # ppc64 needs to be configured manually with Configure instead of config.
    if option platform:ppc64; then
        ./Configure linux-ppc64 --prefix=/usr --openssldir=/etc/ssl \
            shared threads || die "Configure failed"
    else
        ./config --prefix=/usr --openssldir=/etc/ssl \
            shared threads || die "Configure failed"
    fi
}

# parallel build is broken
DEFAULT_SRC_COMPILE_PARAMS=( -j1 )

DEFAULT_SRC_INSTALL_PARAMS=( INSTALL_PREFIX="${IMAGE}" )

src_install() {
    default
    keepdir /etc/ssl/{certs,private}
}

