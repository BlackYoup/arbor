# Copyright 2009 Wulf C. Krueger
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'libevent-1.4.3.ebuild' from Gentoo, which is:
#     Copyright 1999-2008 Gentoo Foundation

export_exlib_phases src_test

MY_PNV="${PNV}-stable"

SUMMARY="A library to execute a function when a specific event occurs on a file descriptor"
HOMEPAGE="http://monkey.org/~provos/libevent/"
DOWNLOADS="http://monkey.org/~provos/${MY_PNV}.tar.gz"

LICENCES="BSD-3"
SLOT="0"
MYOPTIONS=""
DEPENDENCIES=""

WORK="${WORKBASE}/${MY_PNV}"

DEFAULT_SRC_PREPARE_PATCHES=( "${FILES}/${PN}-1.4.3-test.patch" )

libevent_src_test() {
    pushd test >/dev/null
    einfo "Running tests"
    ./test.sh > "${TEMP}"/tests
    cat "${TEMP}"/tests
    grep FAILED "${TEMP}"/tests &>/dev/null && die "1 or more tests failed"
    popd >/dev/null
}
