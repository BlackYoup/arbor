# Copyright 2009 Wulf C. Krueger <philantrop@exherbo.org>
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'libevent-1.4.3.ebuild' from Gentoo, which is:
#     Copyright 1999-2008 Gentoo Foundation

MY_PNV="${PNV}-stable"
require sourceforge [ project=levent pnv=${MY_PNV} suffix=tar.gz ] easy-multibuild [ multiunpack=true work=${MY_PNV} ]

SUMMARY="A library to execute a function when a specific event occurs on a file descriptor"
HOMEPAGE="http://${PN}.org"

REMOTE_IDS+=" freecode:${PN}"

LICENCES="BSD-3"
SLOT="0"
MYOPTIONS="multibuild_c: 32 64"

DEPENDENCIES="
    build+run:
        virtual/libssl[multibuild_c:*(-)?]
"

DEFAULT_SRC_PREPARE_PATCHES=( "${FILES}"/${PN}-2.0.10-test.patch )
DEFAULT_SRC_CONFIGURE_PARAMS=( --enable-openssl --disable-static )

test_one_multibuild() {
    pushd test
    edo ./test.sh > "${TEMP}"/tests
    cat "${TEMP}"/tests
    grep -q FAILED "${TEMP}"/tests && die "1 or more tests failed"
    popd
}

