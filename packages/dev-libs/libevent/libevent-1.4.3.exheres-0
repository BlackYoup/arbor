# Copyright 2008 Wulf C. Krueger
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'libevent-1.4.3.ebuild' from Gentoo, which is:
#     Copyright 1999-2008 Gentoo Foundation

MY_P="${P}-stable"

DESCRIPTION="A library to execute a function when a specific event occurs on a file descriptor"
HOMEPAGE="http://monkey.org/~provos/libevent/"
SRC_URI="http://monkey.org/~provos/${MY_P}.tar.gz"

LICENSE="BSD"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS=""

DEPENDENCIES=""

S="${WORKDIR}/${MY_P}"

DEFAULT_SRC_PREPARE_PATCHES=(
    "${FILESDIR}/${P}-test.patch"
)

src_test() {
    pushd test >/dev/null
    einfo "Running tests"
    ./test.sh > "${T}"/tests
    cat "${T}"/tests
    grep FAILED "${T}"/tests &>/dev/null && die "1 or more tests failed"
    popd >/dev/null
}
