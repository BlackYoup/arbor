# Copyright 2009, 2010 Ingmar Vanhassel
# Distributed under the terms of the GNU General Public License v2

require autotools [ supported_autoconf=[ 2.5 ] supported_automake=[ 1.11 1.10 ] ]

SUMMARY="A validating XML parser written in a portable subset of C++"
HOMEPAGE="http://xerces.apache.org/xerces-c/"
DOWNLOADS="mirror://apache/xerces/c/$(ever major)/sources/${PNV}.tar.gz"

LICENCES="Apache-2.0"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS="amd64_cpu_features: sse2"

DEPENDENCIES="
    build+run:
        net-misc/curl
"

AT_M4DIR=( m4 )

DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( amd64_cpu_features:sse2 )
DEFAULT_SRC_CONFIGURE_PARAMS=(
    --enable-threads
    --enable-msgloader-iconv
    --enable-netaccessor-curl
    --enable-transcoder-gnuiconv
)

src_prepare() {
    edo sed -e 's|$(prefix)/msg|$(DESTDIR)/$(prefix)/share/xerces-c/msg|' \
            -i src/xercesc/util/MsgLoaders/MsgCatalog/Makefile.in
    autotools_src_prepare
}

src_install() {
    default

    hereenvd 30xerces-c <<EOF
# See http://xerces.apache.org/xerces-c/samples-3.html
# via http://bugs.gentoo.org/show_bug.cgi?id=259408#c7
XERCESC_NLS_HOME=/usr/share/xerces-c/msg
EOF
}

