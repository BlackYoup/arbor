Source: http://gcc.gnu.org/bugzilla/show_bug.cgi?id=39177
Upstream: Yes.
Reason: gcc:4.4[java] would fail to build when it picked up its own gjar on /.

From 8d42d194b7d2a7402fb499d533425e346701ab5d Mon Sep 17 00:00:00 2001
From: rguenth <rguenth@138bc75d-0d04-0410-961f-82ee72b054a4>
Date: Thu, 22 Oct 2009 15:50:46 +0000
Subject: [PATCH] 2009-10-22  Richard Guenther  <rguenther@suse.de>

        PR cp-tools/39177
        * tools/gnu/classpath/tools/jar/Creator.java (writeCommandLineEntries):
        Do not use uninitialized manifest.
        * tools/classes/gnu/classpath/tools/jar/Creator.class: Re-generated.


git-svn-id: svn+ssh://gcc.gnu.org/svn/gcc/branches/gcc-4_4-branch@153462 138bc75d-0d04-0410-961f-82ee72b054a4
---
 libjava/classpath/ChangeLog                        |    7 +++++++
 .../classes/gnu/classpath/tools/jar/Creator.class  |  Bin 7259 -> 6001 bytes
 .../tools/gnu/classpath/tools/jar/Creator.java     |   11 +++++++----
 3 files changed, 14 insertions(+), 4 deletions(-)

diff --git a/libjava/classpath/ChangeLog b/libjava/classpath/ChangeLog
index fe33efe..656bad0 100644
--- a/libjava/classpath/ChangeLog
+++ b/libjava/classpath/ChangeLog
@@ -1,3 +1,10 @@
+2009-10-22  Richard Guenther  <rguenther@suse.de>
+
+	PR cp-tools/39177
+	* tools/gnu/classpath/tools/jar/Creator.java (writeCommandLineEntries):
+	Do not use uninitialized manifest.
+	* tools/classes/gnu/classpath/tools/jar/Creator.class: Re-generated.
+
 2009-10-15  Release Manager
 
 	* GCC 4.4.2 released.
diff --git a/libjava/classpath/tools/classes/gnu/classpath/tools/jar/Creator.class b/libjava/classpath/tools/classes/gnu/classpath/tools/jar/Creator.class
index 517fe0c7a3399962ddb14962645ac43f61b43aa4..ad4cc74f7326bccc5709385e712c7ba6da30b625 100644
GIT binary patch
delta 3229
zcmZuz3w)E+75|^+OTK*RrH`}?4HRgBVw*G#4{5PgpcIfItw>Q8Kqa&vZJ<pdNx|y2
z>ZY4>xGC2?fKBIobn0}#%9m=Cm#@vaCv$V++ifymQ#W+ZO?K`V5S9IY{pH@?d+s^^
z^FQbOlOwa<sV#WoqX+f@m`2NW<PavvLQ%TAs-EO6bP1KokEqlbk8&Lo2u1RxoT4&;
z3QQzu2{YPBa8|9FSKZ>lWK7XfDcf@V?Ps8h&$lFEDU+b{eM?LAMIHoDqa(;()<-u-
z!~LmPPx$iK#&Gkp<{8rkLh6yLe`9AfWh!rBfvL!2KOH@NNmDjB=D5xjn29<$=%_54
zMJQ-y0I9x2ZA(|YFA<A(dC-8fbu`KYj!MTlm@SVw>S?Yl*GgRTFkeTrY}Cpe3$ReG
z)Xp8h2#a;Jup1jqPc+^YZXZad%wB=>ute_H$}8HiRLA)z0mu5nOF2xcJ;ia^>H;j=
z=A2B+Wu<dsNjnNvg8V`FoIol3I#$Zn&aoX4tQHuBW$OA8flIN5;O;V07e#yenI1<~
z^<obqSS!#0rqh))Q_YDErnhRbA}xY-0$u7x=bQG}<)*<QVggRMJlKF<9X;|H=R`*w
zee$?7>~6;<fdrDW&Q%rOfPR6^ibju3<AQi9G2nq0mkA7@j>AVgJ5`V?1U`>7@_N^V
zsaF#6PEy;{*=ZB|C0woJ%Y1Q)tR;Q%E`e+C75S`dqBnwT1-_<o(>XT<Q;z7>gIn<p
z9oG|t{f-%280#?wzKI(Mxv}K@Si<b!5)Rlrtn^?TZqgw?U6hont-!bNZDyy(jCZBF
zZFBCqZTPOhcI@Dbj_zopDWzy@sczQsJ;LbqQMt@L+Pw`oE1b8;P43{RomlO`PW({d
zHry`natGWyai_o#ek6~$rx<q&Ov7{?Kb9V&%zY2;Q>FWftTlX&@d(Ra<91^&(mE`{
zI5j61+Jp*>;C>Fhj+0}KmV7eVMgx115qJ;}u|+)E%NE|OMYiYc^cp>EwO<80K$s*m
zdPP7L{}3+I@$kt8v?r!1k%$f~i6v7WY{jDjkKu87ho_=oEB33zo=}PXf)JALJ1XTG
zx1P(c3BMHBjXm;_+}rXFq0qo#Jf-9JgfdQ|Y?{Cy@JFtk$=wk%lZ28iz)uHcM~Cny
zfoE_;-Yuq-KZh4|JkQzK>Dsm}DKnu)Qs70rB;OY0-skX&z@JsQ_3mi0&AconFCI0g
z5Jw3{>w@J?p_aCVVK-ir_l_D<jW+~-g<mUpZwdSzZ}Y3oW@0VRKY_SC2=A%_T_;~2
z)mC>H?+LuGjKr2`Jk=VF$JUw2lzRPvz`s>RMDK}1)pk1mL-5`BmM_nP5Al&A`#7Pr
zN*<&VU9tTk3gzy+*<&06|G+<a%*ZK_3&A&}3v!bojr^HLE{)Pjs0L^%ER~n$>yA9i
zm$CeMqmYVp^0H5LWALm~F=0lPoLlH;JEuIF@AKv2PB)F_2A)<s)kB5k7c_>(%Ho1W
zYsc}F+Jk3yhUN{pi3Qi5n_A`|8S9ICu!t%IO~h;-9-gwLiN1|yBE^=I2|49eZkoau
zsv7(v-r1LM6H6*pvrJHc)1{!?S5P;2m_mYTDa^J>u2r<lZ0+k*1oJ>`plO1p(+sW-
zt4*t!>h5FZQ8UH-5X}_$3;wFi>IKbGvf^47i^r1PN{QH^Bhepc{^@K%=P3Sjqlu30
z*k)7F@1{8%BjgEVD>Vt4r_{$~Zt9QrBn?h%zMutI!Y=yyxwVPT<xoUAwa9~o6;sb+
zQa?FW=l7>J_McE<4=u)h9$G|gs-#KPC1L6HZlJ01i{7ydSP1yrEe{U<Y=nk6$mcaj
zNi=_s;Zu!YjO9~ckoRt0=M-vq(A}UJ_0Af<W^t+C_Kq!`6!dG365T@e(DA227HWOY
zd)b)eq@tNCH6<LMbx7C1WjlT|FpLs@GGjX?m1x^B&Rai%v$TgWC*laTkD#f+xd-R^
zofcYmXV4x=<H81K1_9n&w5_;!a7DeIK_n7NV^xFUH~cOO7h8z>4IjfX*?G6$u(00m
zR9g!hvrFnk)GaGi%vH+d@_LU?H*VSi!>AWS@D}3>{O9w;e0r~0FT8^cOFscCqWSa@
zT-6?NPEt?5YVTb>p;iSsPeIO8kZl&M;_C+$3)g*?1r{p)vSOR%K?`56(-fHLH8mD)
z)H*GEryzU_MrW`yQZs_@r}2Y=u!UPK+|e2+(Wqveg}a7Omcc!dU>f%}IQi7?w2u{C
zyX@F@iKoDjYkZZ1IZEmngTWDV@Kc-r*Z4n$;O3fP3^R!BxPf;Mw1v1Pr%+5*C_<k`
z(U!s9h<e4`?`sV*>Vqq?P9AB{9CgkiGzNmoCWEcE-CVy`;+&qw&+L>qNY<ZyYT@Uc
z7&}Vi$*Y}I;`D3#Zax0+5R9zjERolaZd#V3gz)1eeq$#Q;U0E!64Np`#EtRW*5ELH
zXW{7vZ3xAF?S4E<IDoxvff~m8q&j$+u;cjAnqB;e<fhVb%ni@)Y4sW4wpWf@RKIv%
zwXkJ{z5AQJW7=PD<-F}U<3AZEq-fy`8ONIz-uXD<^QVe39y&YT4-X?N#@a(Xa1Wyv
zk6<>hi|{B%X01I9kxEq!Y=~VS+W{x-;?2JvL#f>dyyaGC&EUgGO&b5*r8a3oHqB%H
z3T{Kzj?<hz%1LVM^r}E0Xi?5y(v<h@Xb%jNW|6Bcw1+$v6+Di@?5?DUd={0i2o(`G
z;Lb=9jUS=%Y(0x;5?8Z`D*43ToRKZAvL6g&upv^T+@`5|FS^w@28XG}qN#ykn$A4M
z&vXbz^fb5U5ftD#R;A}L5ijsh-xo0-FJU#WYw!v-a^bGv(p`yHIS2k>d|Gy4Rxx5<
z`GMg<)&QzgK`lD#RIIE9zRneSgWtc&BHQqPnxU6jQq-TrfEyn}fm(`awncNdBQFr#
zL(LW~R1-;yA{km7QTJ(DlBU+y0CzDh3|I^3{8Lf09q<lU|6NSLdn^#gSSa7eEPQ~o
Z`D;3dmU6Tlx`3APs-!=czZTnJ{0{_j0r&s_

literal 7259
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
IaXSLP0}nSnM*si-

diff --git a/libjava/classpath/tools/gnu/classpath/tools/jar/Creator.java b/libjava/classpath/tools/gnu/classpath/tools/jar/Creator.java
index a6b6112..6ffce18 100644
--- a/libjava/classpath/tools/gnu/classpath/tools/jar/Creator.java
+++ b/libjava/classpath/tools/gnu/classpath/tools/jar/Creator.java
@@ -216,11 +216,14 @@ public class Creator
     manifest = createManifest(parameters);
     /* If no version is specified, provide the same manifest version default
      * as Sun's jar tool */
-    Attributes attr = manifest.getMainAttributes();
-    if (attr.getValue(Attributes.Name.MANIFEST_VERSION) == null)
-      attr.putValue(Attributes.Name.MANIFEST_VERSION.toString(), "1.0");
-    attr.putValue("Created-By", System.getProperty("java.version") +
+    if (parameters.wantManifest)
+      {
+	  Attributes attr = manifest.getMainAttributes();
+	  if (attr.getValue(Attributes.Name.MANIFEST_VERSION) == null)
+	      attr.putValue(Attributes.Name.MANIFEST_VERSION.toString(), "1.0");
+	  attr.putValue("Created-By", System.getProperty("java.version") +
 		  " (" + System.getProperty("java.vendor") + ")");
+      }
     outputStream = new JarOutputStream(os, manifest);
     // FIXME: this sets the method too late for the manifest file.
     outputStream.setMethod(parameters.storageMode);
-- 
1.6.6.rc2.275.g51e2d

