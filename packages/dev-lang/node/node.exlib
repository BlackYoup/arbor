# Copyright 2011 Michael Thomas <aelmalinka@gmail.com>
# Distributed under the terms of the GNU General Public Licesnse v2

export_exlib_phases src_test src_install

MY_PV="v${PV}"
MY_PNV="${PN}-${MY_PV}"
WORK="${WORKBASE}/${MY_PNV}"

SUMMARY="Evented I/O for V8 Javascript"
DESCRIPTION="Desgined to provide an easy way to build scalable network applications, similar to Event Machine or Twisted"
DOWNLOADS="http://nodejs.org/dist/${MY_PV}/${MY_PNV}.tar.gz"
HOMEPAGE="http://nodejs.org/"
LICENCES="MIT"

require waf

DEPENDENCIES="
    build+run:
        dev-libs/libev
        dev-libs/libpthread-stubs
        dev-libs/openssl
        dev-libs/v8
        net-dns/c-ares
"

WAF_SRC_CONFIGURE_PARAMS=(
    --shared-cares
    --shared-v8
)

node_src_install() {
    default

    edo rmdir "${IMAGE}/usr/include/node/ev"
}

node_src_test() {
    esandbox disable_net
    emake "${DEFAULT_SRC_TEST_PARAMS[@]}" test
    esandbox enable_net
}
