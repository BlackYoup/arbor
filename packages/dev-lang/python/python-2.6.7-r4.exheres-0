# Copyright 2009, 2010 Ingmar Vanhassel
# Distributed under the terms of the GNU General Public License v2

require python-build

PLATFORMS="~amd64 ~arm ~ia64 ~ppc64 ~x86"

src_test() {
    local DISABLE_TESTS
    # test_build_ext (test_distutils) fails for fresh installs
    # I've not tested if any python version is compatible so depend on :2.6
    has_version --root "dev-lang/python:2.6" || DISABLE_TESTS+="test_distutils"
    # wants to bind 0.0.0.0/::
    DISABLE_TESTS+=" test_ftplib test_socket test_urllib2"

    # needed for test_socket
    esandbox allow_net "unix-abstract:python-test-hello"
    esandbox allow_net "unix-abstract:hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh"

    python-build_src_test
}

src_install() {
    python-build_src_install

    # Installs empty directory.
    edo rmdir "${IMAGE}"/usr/${LIBDIR}/${PN}${SLOT}/lib-old
}

