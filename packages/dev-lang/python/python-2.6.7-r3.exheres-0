# Copyright 2009, 2010 Ingmar Vanhassel
# Distributed under the terms of the GNU General Public License v2

require python-build

PLATFORMS="~amd64 ~arm ~ia64 ~ppc64 ~x86"

prepare_one_multibuild() {
    edo cd "${WORKBASE}/${MULTIBUILD_CLASS}/${MULTIBUILD_TARGET}/Python-${PV}"

    # support autoconf versions other than 2.65
    edo sed -i -e "s:\"lib\":\"${LIBDIR}\":g" Lib/distutils/tests/test_install.py

    python-build_prepare_one_multibuild
}

test_prepare_one_multibuild() {
    edo cd "${WORKBASE}/${MULTIBUILD_CLASS}/${MULTIBUILD_TARGET}/Python-${PV}"

    # Fails for fresh installs
    edo rm Lib/distutils/tests/test_build_ext.py

    # needed for test_socket
    esandbox allow_net "unix-abstract:python-test-hello"
    esandbox allow_net "unix-abstract:hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh"

    python-build_test_prepare_one_multibuild
}

install_one_multibuild() {
    python-build_install_one_multibuild

    # Installs empty directory.
    edo rmdir "${IMAGE}"/usr/${LIBDIR}/${PN}${SLOT}/lib-old
}

