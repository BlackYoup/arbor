# Copyright 2009, 2010 Ingmar Vanhassel
# Distributed under the terms of the GNU General Public License v2

require python-build

PLATFORMS="~amd64 ~arm ~ia64 ~ppc64 ~x86"

src_prepare() {
    python-build_src_prepare

    edo sed -ie "s:@@EXHERBO_LIBDIR@@:${LIBDIR}:g" \
        Lib/distutils/tests/test_install.py
}

src_test() {
    # needed for test_socket
    esandbox allow_net --connect "inet:127.0.0.1@80"
    esandbox allow_net --connect "inet6:::1@80"
    esandbox allow_net "unix-abstract:python-test-hello"
    esandbox allow_net "unix-abstract:hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh"

    # needed for test_xmlrpc
    esandbox allow_net --connect "inet:127.0.0.1@9999"

    python-build_src_test

    esandbox disallow_net --connect "inet:127.0.0.1@80"
    esandbox disallow_net --connect "inet6:::1@80"
    esandbox disallow_net --connect "inet:127.0.0.1@9999"
}

