# Copyright 2009, 2010 Ingmar Vanhassel
# Distributed under the terms of the GNU General Public License v2

require python-build

PLATFORMS="~amd64 ~arm ~ia64 ~ppc64 ~x86"

DEPENDENCIES+="
    build+run:
        dev-libs/expat
"

DEFAULT_SRC_CONFIGURE_PARAMS+=( '--with-system-expat' )

src_test() {
    local DISABLE_TESTS
    # test_install_lib (test_distuils) has problems with path resolution
    # the rest want to bind to 0.0.0.0/::, test_{urllib,uuid}: socket.gethostname() name->resolution
    DISABLE_TESTS="test_distutils test_ftplib test_pydoc test_socket test_urllib test_uuid"

    esandbox allow_net --connect "inet:127.0.0.1@0"

    python-build_src_test

    esandbox disallow_net --connect "inet:127.0.0.1@0"

}

