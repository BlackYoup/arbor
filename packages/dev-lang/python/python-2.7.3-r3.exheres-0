# Copyright 2010 Paul Seidler
# Distributed under the terms of the GNU General Public License v2

require python-build

PLATFORMS="~amd64 ~ppc64 ~x86"

DEPENDENCIES+="
    build:
        sys-devel/autoconf[>=2.65]
    build+run:
        dev-libs/expat[multibuild_c:*(-)?]
"

DEFAULT_SRC_CONFIGURE_PARAMS+=( '--with-system-expat' )

prepare_one_multibuild() {
    python-build_prepare_one_multibuild

    # replace still to be done libdir variables
    edo sed -i -e "s:@@EXHERBO_LIBDIR@@:${LIBDIR}:g" \
        Lib/sysconfig.py \
        Lib/test/test_site.py
}

test_one_multibuild() {
    local DISABLE_TESTS
    # test_install_lib (test_distuils) has problems with path resolution
    # test_gdb: fails under sydbox (scm, a1f1106)
    # the rest wants to bind to 0.0.0.0/::
    DISABLE_TESTS="test_distutils test_ftplib test_gdb test_socket"

    python-build_test_one_multibuild
}

