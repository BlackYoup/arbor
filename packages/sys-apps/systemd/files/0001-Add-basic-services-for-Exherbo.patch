From e257b53240208eae96da972ceb932896c98d901d Mon Sep 17 00:00:00 2001
From: Wulf C. Krueger <philantrop@exherbo.org>
Date: Sun, 29 Aug 2010 13:05:45 +0200
Subject: [PATCH] Add basic services for Exherbo.

---
 Makefile.am                    |    8 ++++++++
 units/exherbo/halt.service     |   20 ++++++++++++++++++++
 units/exherbo/killall.service  |   21 +++++++++++++++++++++
 units/exherbo/poweroff.service |   20 ++++++++++++++++++++
 units/exherbo/reboot.service   |   19 +++++++++++++++++++
 5 files changed, 88 insertions(+), 0 deletions(-)
 create mode 100644 units/exherbo/halt.service
 create mode 100644 units/exherbo/killall.service
 create mode 100644 units/exherbo/poweroff.service
 create mode 100644 units/exherbo/reboot.service

diff --git a/Makefile.am b/Makefile.am
index 8711a52..191e807 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -272,6 +272,14 @@ dist_systemunit_DATA += \
 	units/arch/reboot.service
 endif
 
+if TARGET_EXHERBO
+dist_systemunit_DATA += \
+	units/exherbo/halt.service \
+	units/exherbo/killall.service \
+	units/exherbo/reboot.service \
+	units/exherbo/poweroff.service
+endif
+
 dist_doc_DATA = \
 	README \
 	LICENSE \
diff --git a/units/exherbo/halt.service b/units/exherbo/halt.service
new file mode 100644
index 0000000..bbc90ed
--- /dev/null
+++ b/units/exherbo/halt.service
@@ -0,0 +1,20 @@
+#  This file is part of systemd.
+#
+#  systemd is free software; you can redistribute it and/or modify it
+#  under the terms of the GNU General Public License as published by
+#  the Free Software Foundation; either version 2 of the License, or
+#  (at your option) any later version.
+
+[Unit]
+Description=Halt
+DefaultDependencies=no
+Requires=shutdown.target umount.target killall.service
+After=shutdown.target umount.target killall.service
+
+[Service]
+Type=oneshot
+RemainAfterExit=yes
+Environment=RUNLEVEL=0
+ExecStart=/sbin/halt -dih
+ExecStartPost=/sbin/halt -f
+StandardOutput=tty
diff --git a/units/exherbo/killall.service b/units/exherbo/killall.service
new file mode 100644
index 0000000..ac5ae05
--- /dev/null
+++ b/units/exherbo/killall.service
@@ -0,0 +1,21 @@
+#  This file is part of systemd.
+#
+#  systemd is free software; you can redistribute it and/or modify it
+#  under the terms of the GNU General Public License as published by
+#  the Free Software Foundation; either version 2 of the License, or
+#  (at your option) any later version.
+
+[Unit]
+Description=Kill All Processes
+DefaultDependencies=no
+After=shutdown.target
+RefuseManualStart=yes
+
+[Service]
+Type=oneshot
+RemainAfterExit=yes
+ExecStart=-/sbin/killall5 -15
+ExecStartPost=-/usr/bin/sleep 1
+ExecStartPost=-/sbin/killall5 -9
+ExecStartPost=-/usr/bin/sleep 1
+StandardOutput=tty
diff --git a/units/exherbo/poweroff.service b/units/exherbo/poweroff.service
new file mode 100644
index 0000000..7179242
--- /dev/null
+++ b/units/exherbo/poweroff.service
@@ -0,0 +1,20 @@
+#  This file is part of systemd.
+#
+#  systemd is free software; you can redistribute it and/or modify it
+#  under the terms of the GNU General Public License as published by
+#  the Free Software Foundation; either version 2 of the License, or
+#  (at your option) any later version.
+
+[Unit]
+Description=Halt
+DefaultDependencies=no
+Requires=shutdown.target umount.target killall.service
+After=shutdown.target umount.target killall.service
+
+[Service]
+Type=oneshot
+RemainAfterExit=yes
+Environment=RUNLEVEL=0
+ExecStart=/sbin/halt -dihp
+ExecStartPost=/sbin/halt -f
+StandardOutput=tty
diff --git a/units/exherbo/reboot.service b/units/exherbo/reboot.service
new file mode 100644
index 0000000..8ae0d6f
--- /dev/null
+++ b/units/exherbo/reboot.service
@@ -0,0 +1,19 @@
+#  This file is part of systemd.
+#
+#  systemd is free software; you can redistribute it and/or modify it
+#  under the terms of the GNU General Public License as published by
+#  the Free Software Foundation; either version 2 of the License, or
+#  (at your option) any later version.
+
+[Unit]
+Description=Reboot
+DefaultDependencies=no
+Requires=shutdown.target umount.target killall.service
+After=shutdown.target umount.target killall.service
+
+[Service]
+Type=oneshot
+RemainAfterExit=yes
+Environment=RUNLEVEL=6
+ExecStart=/sbin/reboot -dpkif
+StandardOutput=tty
-- 
1.7.2.3

