From cbcbad854daa943e0423e0f308922d47ba2ba108 Mon Sep 17 00:00:00 2001
From: Wulf C. Krueger <philantrop@exherbo.org>
Date: Mon, 30 Aug 2010 21:21:58 +0000
Subject: [PATCH] Don't install systemd scripts with --without-systemdsystemunitdir.
Upstream: https://bugs.freedesktop.org/show_bug.cgi?id=29892

---
 configure.in |    6 ++++--
 1 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/configure.in b/configure.in
index c0a831b..2950297 100644
--- a/configure.in
+++ b/configure.in
@@ -1388,8 +1388,10 @@ AM_CONDITIONAL(DBUS_INIT_SCRIPTS_CYGWIN, test x$with_init_scripts = xcygwin)
 AC_ARG_WITH([systemdsystemunitdir],
 AS_HELP_STRING([--with-systemdsystemunitdir=DIR], [Directory for systemd service files]),
         [], [with_systemdsystemunitdir=$($PKG_CONFIG --variable=systemdsystemunitdir systemd)])
-AC_SUBST([systemdsystemunitdir], [$with_systemdsystemunitdir])
-AM_CONDITIONAL(HAVE_SYSTEMD, [test -n "$with_systemdsystemunitdir"])
+if test "x$with_systemdsystemunitdir" != xno; then
+   AC_SUBST([systemdsystemunitdir], [$with_systemdsystemunitdir])
+fi
+AM_CONDITIONAL(HAVE_SYSTEMD, [test -n "$with_systemdsystemunitdir" -a "x$with_systemdsystemunitdir" != xno ])
 
 ##### Set up location for system bus socket
 if ! test -z "$with_system_socket"; then
-- 
1.7.2.2

